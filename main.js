/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ce=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var Le=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var Ie=(d,t)=>{for(var e in t)ce(d,e,{get:t[e],enumerable:!0})},Ne=(d,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Le(t))!Ee.call(d,s)&&s!==e&&ce(d,s,{get:()=>t[s],enumerable:!(r=be(t,s))||r.enumerable});return d};var Ae=d=>Ne(ce({},"__esModule",{value:!0}),d);var Ke={};Ie(Ke,{default:()=>de});module.exports=Ae(Ke);var S=require("obsidian");var y=class d{constructor(t){this._value=t}get value(){return this._value}static notStarted(){return new d("not_started")}static inProgress(){return new d("in_progress")}static completed(){return new d("completed")}static fromString(t){switch(t.toLowerCase()){case"in_progress":return d.inProgress();case"completed":return d.completed();default:return d.notStarted()}}isNotStarted(){return this._value==="not_started"}isInProgress(){return this._value==="in_progress"}isCompleted(){return this._value==="completed"}startLearning(){return this._value==="completed"?this:d.inProgress()}complete(){return d.completed()}reset(){return d.notStarted()}equals(t){return this._value===t._value}progressPercent(){switch(this._value){case"not_started":return 0;case"in_progress":return 50;case"completed":return 100}}toString(){return this._value}toDisplayLabel(){switch(this._value){case"not_started":return"Not Started";case"in_progress":return"In Progress";case"completed":return"Completed"}}toIcon(){switch(this._value){case"not_started":return"\u2B1C";case"in_progress":return"\u{1F504}";case"completed":return"\u2705"}}};var x=class d{constructor(t,e,r,s){this._sourceId=t;this._targetId=e;this._type=r;this._confidence=s}get sourceId(){return this._sourceId}get targetId(){return this._targetId}get type(){return this._type}get confidence(){return this._confidence}static prerequisite(t,e,r=1){return d.create(t,e,"prerequisite",r)}static related(t,e,r=1){return d.create(t,e,"related",r)}static optional(t,e,r=1){return d.create(t,e,"optional",r)}static create(t,e,r,s){if(!t||!e)throw new Error("Source and target IDs must not be empty");if(t===e)throw new Error("Self-reference dependency is not allowed");let n=Math.max(0,Math.min(1,s));return new d(t,e,r,n)}static fromObject(t){let e=d.parseType(t.type);return d.create(t.sourceId,t.targetId,e,t.confidence)}static parseType(t){switch(t.toLowerCase()){case"prerequisite":return"prerequisite";case"related":return"related";case"optional":return"optional";default:return"related"}}isPrerequisite(){return this._type==="prerequisite"}isRelated(){return this._type==="related"}isOptional(){return this._type==="optional"}inverse(){return d.create(this._targetId,this._sourceId,this._type,this._confidence)}equals(t){return this._sourceId===t._sourceId&&this._targetId===t._targetId&&this._type===t._type}toObject(){return{sourceId:this._sourceId,targetId:this._targetId,type:this._type,confidence:this._confidence}}toDisplayString(){let t=this.getTypeLabel();return`${this._sourceId} \u2192 ${this._targetId} (${t})`}getTypeLabel(){switch(this._type){case"prerequisite":return"Prerequisite";case"related":return"Related";case"optional":return"Optional"}}};var z=class d{constructor(t,e,r,s,n){this._totalNodes=t;this._completedNodes=e;this._inProgressNodes=r;this._notStartedNodes=s;this._estimatedMinutes=n}get totalNodes(){return this._totalNodes}get completedNodes(){return this._completedNodes}get inProgressNodes(){return this._inProgressNodes}get notStartedNodes(){return this._notStartedNodes}get estimatedMinutes(){return this._estimatedMinutes}static create(t){return new d(t.totalNodes,t.completedNodes,t.inProgressNodes,t.notStartedNodes,t.estimatedMinutes)}static empty(){return new d(0,0,0,0,0)}static fromNodes(t,e,r,s=15){let n=t-e-r,a=(t-e)*s;return new d(t,e,r,n,a)}progressPercent(){return this._totalNodes===0?0:Math.round(this._completedNodes/this._totalNodes*100)}remainingNodes(){return this._totalNodes-this._completedNodes}estimatedHours(){return Math.round(this._estimatedMinutes/60*10)/10}isCompleted(){return this._completedNodes===this._totalNodes&&this._totalNodes>0}isEmpty(){return this._totalNodes===0}withUpdatedProgress(t,e,r=15){return d.fromNodes(this._totalNodes,t,e,r)}toObject(){return{totalNodes:this._totalNodes,completedNodes:this._completedNodes,inProgressNodes:this._inProgressNodes,notStartedNodes:this._notStartedNodes,estimatedMinutes:this._estimatedMinutes}}toDisplayString(){let t=this.progressPercent(),e=this.estimatedHours();return`${this._completedNodes}/${this._totalNodes} (${t}%) - Est. ${e}h`}toProgressBar(t=20){let e=Math.round(this.progressPercent()/100*t),r=t-e;return"\u2501".repeat(e)+"\u2591".repeat(r)}};var _=class d{constructor(t,e,r,s,n,i,a,o){this._noteId=t;this._notePath=e;this._title=r;this._order=s;this._masteryLevel=n;this._dependencies=i;this._lastStudied=a;this._estimatedMinutes=o}get noteId(){return this._noteId}get notePath(){return this._notePath}get title(){return this._title}get order(){return this._order}get masteryLevel(){return this._masteryLevel}get dependencies(){return this._dependencies}get lastStudied(){return this._lastStudied}get estimatedMinutes(){return this._estimatedMinutes}static create(t){var e,r,s,n,i;if(!t.noteId||!t.notePath)throw new Error("Note ID and path are required");return new d(t.noteId,t.notePath,t.title||t.noteId,(e=t.order)!=null?e:0,(r=t.masteryLevel)!=null?r:y.notStarted(),(s=t.dependencies)!=null?s:[],(n=t.lastStudied)!=null?n:null,(i=t.estimatedMinutes)!=null?i:15)}static fromData(t){var r;let e=t.dependencies.map(s=>x.fromObject(s));return new d(t.noteId,t.notePath,t.title,t.order,y.fromString(t.masteryLevel),e,t.lastStudied?new Date(t.lastStudied):null,(r=t.estimatedMinutes)!=null?r:15)}isCompleted(){return this._masteryLevel.isCompleted()}isInProgress(){return this._masteryLevel.isInProgress()}isNotStarted(){return this._masteryLevel.isNotStarted()}hasPrerequisites(){return this._dependencies.some(t=>t.isPrerequisite())}getPrerequisites(){return this._dependencies.filter(t=>t.isPrerequisite())}startLearning(){return new d(this._noteId,this._notePath,this._title,this._order,this._masteryLevel.startLearning(),this._dependencies,new Date,this._estimatedMinutes)}complete(){return new d(this._noteId,this._notePath,this._title,this._order,this._masteryLevel.complete(),this._dependencies,new Date,this._estimatedMinutes)}reset(){return new d(this._noteId,this._notePath,this._title,this._order,this._masteryLevel.reset(),this._dependencies,null,this._estimatedMinutes)}withOrder(t){return new d(this._noteId,this._notePath,this._title,t,this._masteryLevel,this._dependencies,this._lastStudied,this._estimatedMinutes)}withDependencies(t){return new d(this._noteId,this._notePath,this._title,this._order,this._masteryLevel,t,this._lastStudied,this._estimatedMinutes)}toData(){var t;return{noteId:this._noteId,notePath:this._notePath,title:this._title,order:this._order,masteryLevel:this._masteryLevel.toString(),dependencies:this._dependencies.map(e=>e.toObject()),lastStudied:(t=this._lastStudied)==null?void 0:t.toISOString(),estimatedMinutes:this._estimatedMinutes}}toDisplayString(){return`${this._masteryLevel.toIcon()} ${this._order}. ${this._title}`}};var M=class d{constructor(t,e,r,s,n,i,a,o){this._id=t;this._goalNoteId=e;this._goalNoteTitle=r;this._nodes=s;this._knowledgeGaps=n;this._totalAnalyzedNotes=i;this._createdAt=a;this._updatedAt=o}get id(){return this._id}get goalNoteId(){return this._goalNoteId}get goalNoteTitle(){return this._goalNoteTitle}get nodes(){return this._nodes}get createdAt(){return this._createdAt}get updatedAt(){return this._updatedAt}get knowledgeGaps(){return this._knowledgeGaps}get totalAnalyzedNotes(){return this._totalAnalyzedNotes}static create(t){var r,s,n;if(!t.id||!t.goalNoteId)throw new Error("ID and goal note ID are required");let e=new Date;return new d(t.id,t.goalNoteId,t.goalNoteTitle||t.goalNoteId,(r=t.nodes)!=null?r:[],(s=t.knowledgeGaps)!=null?s:[],(n=t.totalAnalyzedNotes)!=null?n:0,e,e)}static fromData(t){var r,s;let e=t.nodes.map(n=>_.fromData(n));return new d(t.id,t.goalNoteId,t.goalNoteTitle,e,(r=t.knowledgeGaps)!=null?r:[],(s=t.totalAnalyzedNotes)!=null?s:0,new Date(t.createdAt),new Date(t.updatedAt))}static generateId(){return`path-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}addNode(t){let e=this._nodes.findIndex(s=>s.noteId===t.noteId),r;if(e>=0)r=[...this._nodes],r[e]=t;else{let s=this._nodes.length+1;r=[...this._nodes,t.withOrder(s)]}return new d(this._id,this._goalNoteId,this._goalNoteTitle,r,this._knowledgeGaps,this._totalAnalyzedNotes,this._createdAt,new Date)}removeNode(t){let e=this._nodes.filter(r=>r.noteId!==t).map((r,s)=>r.withOrder(s+1));return new d(this._id,this._goalNoteId,this._goalNoteTitle,e,this._knowledgeGaps,this._totalAnalyzedNotes,this._createdAt,new Date)}setNodes(t){let e=t.map((r,s)=>r.withOrder(s+1));return new d(this._id,this._goalNoteId,this._goalNoteTitle,e,this._knowledgeGaps,this._totalAnalyzedNotes,this._createdAt,new Date)}updateNodeProgress(t,e){let r=this._nodes.map(s=>s.noteId===t?e.isCompleted()?s.complete():e.isInProgress()?s.startLearning():s.reset():s);return new d(this._id,this._goalNoteId,this._goalNoteTitle,r,this._knowledgeGaps,this._totalAnalyzedNotes,this._createdAt,new Date)}markNodeCompleted(t){return this.updateNodeProgress(t,y.completed())}markNodeInProgress(t){return this.updateNodeProgress(t,y.inProgress())}resetNode(t){return this.updateNodeProgress(t,y.notStarted())}resetAllProgress(){let t=this._nodes.map(e=>e.reset());return new d(this._id,this._goalNoteId,this._goalNoteTitle,t,this._knowledgeGaps,this._totalAnalyzedNotes,this._createdAt,new Date)}getNode(t){return this._nodes.find(e=>e.noteId===t)}getNodeByOrder(t){return this._nodes.find(e=>e.order===t)}getCurrentNode(){return this._nodes.find(t=>!t.isCompleted())}getCompletedNodes(){return this._nodes.filter(t=>t.isCompleted())}getInProgressNodes(){return this._nodes.filter(t=>t.isInProgress())}getNotStartedNodes(){return this._nodes.filter(t=>t.isNotStarted())}getStatistics(){let t=this.getCompletedNodes().length,e=this.getInProgressNodes().length,r=this._nodes.reduce((n,i)=>n+i.estimatedMinutes,0),s=this._nodes.length>0?r/this._nodes.length:15;return z.fromNodes(this._nodes.length,t,e,s)}isCompleted(){return this._nodes.length>0&&this._nodes.every(t=>t.isCompleted())}isEmpty(){return this._nodes.length===0}hasCircularDependency(){let t=new Map;for(let n of this._nodes)t.set(n.noteId,[]);for(let n of this._nodes)for(let i of n.getPrerequisites()){let a=t.get(i.targetId);a&&a.push(i.sourceId)}let e=new Set,r=new Set,s=n=>{var a;e.add(n),r.add(n);let i=(a=t.get(n))!=null?a:[];for(let o of i)if(e.has(o)){if(r.has(o))return!0}else if(s(o))return!0;return r.delete(n),!1};for(let n of this._nodes)if(!e.has(n.noteId)&&s(n.noteId))return!0;return!1}toData(){return{id:this._id,goalNoteId:this._goalNoteId,goalNoteTitle:this._goalNoteTitle,nodes:this._nodes.map(t=>t.toData()),knowledgeGaps:this._knowledgeGaps.length>0?[...this._knowledgeGaps]:void 0,totalAnalyzedNotes:this._totalAnalyzedNotes>0?this._totalAnalyzedNotes:void 0,createdAt:this._createdAt.toISOString(),updatedAt:this._updatedAt.toISOString()}}toDisplayString(){let t=this.getStatistics();return`\u{1F3AF} ${this._goalNoteTitle} - ${t.toDisplayString()}`}};var B=class d{constructor(t,e,r,s,n,i,a){this._id=t;this._concept=e;this._description=r;this._requiredBy=s;this._suggestedResources=n;this._priority=i;this._createdAt=a}get id(){return this._id}get concept(){return this._concept}get description(){return this._description}get requiredBy(){return this._requiredBy}get suggestedResources(){return this._suggestedResources}get priority(){return this._priority}get createdAt(){return this._createdAt}static create(t){var r,s,n,i;if(!t.concept)throw new Error("Concept is required");let e=(r=t.id)!=null?r:`gap-${Date.now()}-${Math.random().toString(36).substring(2,9)}`;return new d(e,t.concept,t.description||"",(s=t.requiredBy)!=null?s:[],(n=t.suggestedResources)!=null?n:[],(i=t.priority)!=null?i:"medium",new Date)}static fromData(t){return new d(t.id,t.concept,t.description,t.requiredBy,t.suggestedResources,t.priority,new Date(t.createdAt))}isHighPriority(){return this._priority==="high"}isMediumPriority(){return this._priority==="medium"}isLowPriority(){return this._priority==="low"}addRequiredBy(t){return this._requiredBy.includes(t)?this:new d(this._id,this._concept,this._description,[...this._requiredBy,t],this._suggestedResources,this._priority,this._createdAt)}addSuggestedResource(t){return this._suggestedResources.includes(t)?this:new d(this._id,this._concept,this._description,this._requiredBy,[...this._suggestedResources,t],this._priority,this._createdAt)}withPriority(t){return new d(this._id,this._concept,this._description,this._requiredBy,this._suggestedResources,t,this._createdAt)}toData(){return{id:this._id,concept:this._concept,description:this._description,requiredBy:[...this._requiredBy],suggestedResources:[...this._suggestedResources],priority:this._priority,createdAt:this._createdAt.toISOString()}}toDisplayString(){return`${this.getPriorityIcon()} ${this._concept}`}getPriorityIcon(){switch(this._priority){case"high":return"\u{1F534}";case"medium":return"\u{1F7E1}";case"low":return"\u{1F7E2}"}}toSuggestedNoteTitle(){return this._concept}};var f={claude:{id:"claude",name:"Claude",displayName:"Anthropic Claude",endpoint:"https://api.anthropic.com/v1",defaultModel:"claude-sonnet-4-5-20250929",apiKeyPrefix:"sk-ant-"},openai:{id:"openai",name:"OpenAI",displayName:"OpenAI GPT",endpoint:"https://api.openai.com/v1",defaultModel:"gpt-5.2",apiKeyPrefix:"sk-"},gemini:{id:"gemini",name:"Gemini",displayName:"Google Gemini",endpoint:"https://generativelanguage.googleapis.com/v1beta",defaultModel:"gemini-3-flash-preview",apiKeyPrefix:"AIza"},grok:{id:"grok",name:"Grok",displayName:"xAI Grok",endpoint:"https://api.x.ai/v1",defaultModel:"grok-4-1-fast"}},ve={"claude-sonnet-4-5-20250929":{id:"claude-sonnet-4-5-20250929",displayName:"Claude Sonnet 4.5",provider:"claude",maxTokens:16384,inputCostPer1M:3,outputCostPer1M:15},"claude-opus-4-5-20251101":{id:"claude-opus-4-5-20251101",displayName:"Claude Opus 4.5",provider:"claude",maxTokens:32768,inputCostPer1M:15,outputCostPer1M:75},"claude-3-5-haiku-20241022":{id:"claude-3-5-haiku-20241022",displayName:"Claude 3.5 Haiku",provider:"claude",maxTokens:8192,inputCostPer1M:.8,outputCostPer1M:4},"gpt-5.2":{id:"gpt-5.2",displayName:"GPT-5.2",provider:"openai",maxTokens:32768,inputCostPer1M:1.75,outputCostPer1M:14},"gpt-4o-mini":{id:"gpt-4o-mini",displayName:"GPT-4o Mini",provider:"openai",maxTokens:16384,inputCostPer1M:.15,outputCostPer1M:.6},"gemini-3-flash-preview":{id:"gemini-3-flash-preview",displayName:"Gemini 3 Flash",provider:"gemini",maxTokens:65536,inputCostPer1M:.5,outputCostPer1M:3},"gemini-3-pro-preview":{id:"gemini-3-pro-preview",displayName:"Gemini 3 Pro",provider:"gemini",maxTokens:65536,inputCostPer1M:2.5,outputCostPer1M:10},"gemini-2.0-flash":{id:"gemini-2.0-flash",displayName:"Gemini 2.0 Flash",provider:"gemini",maxTokens:8192,inputCostPer1M:.075,outputCostPer1M:.3},"grok-4-1-fast":{id:"grok-4-1-fast",displayName:"Grok 4.1 Fast",provider:"grok",maxTokens:16384,inputCostPer1M:3,outputCostPer1M:15},"grok-4-1-fast-non-reasoning":{id:"grok-4-1-fast-non-reasoning",displayName:"Grok 4.1 Fast (Non-Reasoning)",provider:"grok",maxTokens:16384,inputCostPer1M:.6,outputCostPer1M:4}};function pe(d){return Object.values(ve).filter(t=>t.provider===d)}var q=class{buildGraph(t,e=[]){let r=new Set(t),s=new Map;for(let n of t)s.set(n,[]);for(let n of e)if(n.isPrerequisite()&&r.has(n.sourceId)&&r.has(n.targetId)){let i=s.get(n.sourceId);i&&!i.includes(n.targetId)&&i.push(n.targetId)}return{nodes:r,edges:s}}topologicalSort(t){var n,i,a;if(t.nodes.size===0)return[];let e=new Map;for(let o of t.nodes)e.set(o,0);for(let[,o]of t.edges)for(let l of o)e.set(l,((n=e.get(l))!=null?n:0)+1);let r=[];for(let[o,l]of e)l===0&&r.push(o);let s=[];for(;r.length>0;){r.sort();let o=r.shift();s.push(o);let l=(i=t.edges.get(o))!=null?i:[];for(let c of l){let p=((a=e.get(c))!=null?a:1)-1;e.set(c,p),p===0&&r.push(c)}}if(s.length!==t.nodes.size)throw new Error("Circular dependency detected");return s}detectCycle(t){let e=new Set,r=new Set,s=n=>{var a;e.add(n),r.add(n);let i=(a=t.edges.get(n))!=null?a:[];for(let o of i)if(e.has(o)){if(r.has(o))return!0}else if(s(o))return!0;return r.delete(n),!1};for(let n of t.nodes)if(!e.has(n)&&s(n))return!0;return!1}getAncestors(t,e){var i,a,o;let r=new Set,s=new Map;for(let l of t.nodes)s.set(l,[]);for(let[l,c]of t.edges)for(let p of c)(i=s.get(p))==null||i.push(l);let n=[...(a=s.get(e))!=null?a:[]];for(;n.length>0;){let l=n.shift();if(!r.has(l)){r.add(l);let c=(o=s.get(l))!=null?o:[];n.push(...c)}}return r}getDescendants(t,e){var n,i;let r=new Set,s=[...(n=t.edges.get(e))!=null?n:[]];for(;s.length>0;){let a=s.shift();if(!r.has(a)){r.add(a);let o=(i=t.edges.get(a))!=null?i:[];s.push(...o)}}return r}findPathToGoal(t,e){var a;if(!t.nodes.has(e))throw new Error("Goal node not found");let r=this.getAncestors(t,e);r.add(e);let s=Array.from(r),n=new Map;for(let o of s){let c=((a=t.edges.get(o))!=null?a:[]).filter(p=>r.has(p));n.set(o,c)}let i={nodes:new Set(s),edges:n};return this.topologicalSort(i)}getLevels(t){var n,i,a,o;if(t.nodes.size===0)return[];let e=new Map;for(let l of t.nodes)e.set(l,0);for(let[,l]of t.edges)for(let c of l)e.set(c,((n=e.get(c))!=null?n:0)+1);let r=[],s=new Set(t.nodes);for(;s.size>0;){let l=[];for(let c of s)((i=e.get(c))!=null?i:0)===0&&l.push(c);if(l.length===0)throw new Error("Circular dependency detected");for(let c of l){s.delete(c);let p=(a=t.edges.get(c))!=null?a:[];for(let g of p)e.set(g,((o=e.get(g))!=null?o:1)-1)}r.push(l.sort())}return r}};var O=class{constructor(t,e,r,s){this.noteRepository=t;this.pathRepository=e;this.dependencyAnalyzer=r;this.aiService=s;this.semanticSearchService=null}setSemanticSearchService(t){this.semanticSearchService=t}async execute(t){var r,s,n,i,a,o,l,c;let e=[];try{let p=await this.noteRepository.getAllNotes({folder:t.folder,excludeFolders:t.excludeFolders});if(p.length===0)return{success:!1,error:"No notes found matching the criteria"};let g=new Map(p.map(P=>[P.id,P])),u=t.goalNoteId;if(!u)return{success:!1,error:"Goal note ID is required"};let v=g.get(u);if(!v)return{success:!1,error:`Goal note not found: ${u}`};let h=(s=t.useLLMAnalysis!==!1&&((r=this.aiService)==null?void 0:r.isAvailable()))!=null?s:!1,b=(i=(n=this.semanticSearchService)==null?void 0:n.isAvailable())!=null?i:!1;console.log("[LearningPath] Algorithm selection:",{useLLM:h,useSemanticSearch:b,aiServiceExists:!!this.aiService,aiServiceAvailable:(o=(a=this.aiService)==null?void 0:a.isAvailable())!=null?o:!1,semanticServiceExists:!!this.semanticSearchService,semanticServiceAvailable:(c=(l=this.semanticSearchService)==null?void 0:l.isAvailable())!=null?c:!1,requestUseLLMAnalysis:t.useLLMAnalysis});let I,E=[],L={},N=[],R=0;if(h&&b){console.log("[LearningPath] \u2713 Using NEW semantic search algorithm");let P=await this.executeWithSemanticSearch(v,p,g);if(P.success)I=P.sortedNodeIds,L=P.estimatedMinutes,N=P.knowledgeGaps,R=P.totalAnalyzedNotes,E=[I];else{e.push(`Semantic search failed, switching to link-based analysis: ${P.error}`);let C=await this.executeFallback(v,p,g,h);I=C.sortedNodeIds,L=C.estimatedMinutes,N=C.knowledgeGaps,R=C.totalAnalyzedNotes,E=C.levels,C.warnings&&e.push(...C.warnings)}}else{console.log("[LearningPath] \u2717 Using FALLBACK link-based algorithm"),h||(console.log("[LearningPath] Reason: LLM not available"),e.push("LLM analysis disabled, performing link-based analysis.")),b||(console.log("[LearningPath] Reason: PKM Note Recommender not available"),e.push("PKM Note Recommender not available, performing link-based analysis."));let P=await this.executeFallback(v,p,g,h);I=P.sortedNodeIds,L=P.estimatedMinutes,N=P.knowledgeGaps,R=P.totalAnalyzedNotes,E=P.levels,P.warnings&&e.push(...P.warnings)}let X=I.map((P,C)=>{let se=g.get(P);return se?_.create({noteId:P,notePath:se.path,title:se.basename,order:C,masteryLevel:y.notStarted(),estimatedMinutes:L[se.basename]||15}):null}).filter(P=>P!==null),Se=t.name||v.basename||u,fe=M.create({id:this.generateId(),goalNoteId:u,goalNoteTitle:Se,nodes:X,knowledgeGaps:N,totalAnalyzedNotes:R});return await this.pathRepository.save(fe),{success:!0,path:fe.toData(),nodes:X.map(P=>P.toData()),levels:E,warnings:e.length>0?e:void 0,knowledgeGaps:N.length>0?N:void 0,totalAnalyzedNotes:R}}catch(p){return{success:!1,error:p instanceof Error?p.message:"Unknown error occurred"}}}async executeWithSemanticSearch(t,e,r){if(!this.aiService||!this.semanticSearchService)return{success:!1,sortedNodeIds:[],estimatedMinutes:{},knowledgeGaps:[],totalAnalyzedNotes:0,error:"Required services not available"};console.log("[LearningPath] Extracting prerequisite concepts...");let s=await this.aiService.extractPrerequisiteConcepts({title:t.basename,content:t.content});if(!s.success||!s.data)return{success:!1,sortedNodeIds:[],estimatedMinutes:{},knowledgeGaps:[],totalAnalyzedNotes:0,error:s.error||"Concept extraction failed"};let n=s.data;console.log(`[LearningPath] Extracted ${n.prerequisites.length} concepts, ${n.keywords.length} keywords`);let i=[...n.prerequisites.map(h=>h.concept),...n.keywords.slice(0,5)],a=new Map,o=new Map;for(let h of i){console.log(`[LearningPath] Searching for concept: "${h}"`);let b=await this.semanticSearchService.findSimilarToContent(h,{limit:5,threshold:.3,excludeNoteIds:[t.id]});console.log(`[LearningPath] Results for "${h}": ${b.length} notes found`);let I=[];for(let E of b){let L=r.get(E.noteId);L&&!a.has(E.noteId)&&(a.set(E.noteId,L),I.push(E.noteId))}o.set(h,I)}console.log(`[LearningPath] Found ${a.size} unique related notes`);let l=[];for(let h of n.prerequisites)(o.get(h.concept)||[]).length===0&&l.push({concept:h.concept,reason:h.description,priority:h.importance==="essential"?"high":h.importance==="helpful"?"medium":"low",suggestedResources:[`Search for "${h.concept}" resources`,`${h.concept} introduction`]});if(a.size===0)return{success:!1,sortedNodeIds:[],estimatedMinutes:{},knowledgeGaps:l,totalAnalyzedNotes:0,error:"No related notes found."};let c=Array.from(a.values()).map(h=>({title:h.basename,content:h.content})),p=await this.aiService.analyzeNotesForLearningPath({title:t.basename,content:t.content},c);if(!p.success||!p.data)return{success:!0,sortedNodeIds:[...a.keys(),t.id],estimatedMinutes:{},knowledgeGaps:l,totalAnalyzedNotes:a.size+1};let g=new Map;for(let[h,b]of r)g.set(b.basename,h);g.set(t.basename,t.id);let u=p.data.learningOrder.map(h=>g.get(h)).filter(h=>h!==void 0);u.includes(t.id)||u.push(t.id);let v=p.data.knowledgeGaps||[];for(let h of v)l.find(b=>b.concept===h.concept)||l.push(h);return{success:!0,sortedNodeIds:u,estimatedMinutes:p.data.estimatedMinutes||{},knowledgeGaps:l,totalAnalyzedNotes:a.size+1}}async executeFallback(t,e,r,s){var g;let n=[],i=this.findPathToGoal(e,t.id),a=i.map(u=>r.get(u)).filter(u=>u!==void 0),o,l=[],c={},p=[];if(s&&((g=this.aiService)!=null&&g.isAvailable())){let u=await this.analyzewithLLM(t,a);if(u.success)o=u.learningOrder,c=u.estimatedMinutes,p=u.knowledgeGaps,l=[o];else{n.push(`LLM analysis failed: ${u.error}`);let v=this.analyzeWithLinks(i,e);o=v.sortedIds,l=v.levels,v.hasCycle&&n.push("Circular dependency detected. Some ordering may be arbitrary.")}}else{let u=this.analyzeWithLinks(i,e);o=u.sortedIds,l=u.levels,u.hasCycle&&n.push("Circular dependency detected. Some ordering may be arbitrary.")}return{sortedNodeIds:o,estimatedMinutes:c,knowledgeGaps:p,totalAnalyzedNotes:a.length,levels:l,warnings:n.length>0?n:void 0}}async analyzewithLLM(t,e){if(!this.aiService||!this.aiService.isAvailable())return{success:!1,learningOrder:[],estimatedMinutes:{},knowledgeGaps:[],error:"AI service not available"};let r=e.filter(n=>n.id!==t.id).map(n=>({title:n.basename,content:n.content})),s=await this.aiService.analyzeNotesForLearningPath({title:t.basename,content:t.content},r);return s.success&&s.data?{success:!0,learningOrder:s.data.learningOrder,estimatedMinutes:s.data.estimatedMinutes,knowledgeGaps:s.data.knowledgeGaps}:{success:!1,learningOrder:[],estimatedMinutes:{},knowledgeGaps:[],error:s.error||"LLM analysis failed"}}analyzeWithLinks(t,e){let r=this.extractDependencies(e,t),s=this.dependencyAnalyzer.buildGraph(t,r),n=this.dependencyAnalyzer.detectCycle(s),i,a=[];if(n)i=this.sortWithCycleFallback(t,r),a=[i];else{i=this.dependencyAnalyzer.topologicalSort(s);try{a=this.dependencyAnalyzer.getLevels(s)}catch(o){a=[i]}}return{sortedIds:i,levels:a,hasCycle:n}}expandFromStartNotes(t,e){var i;let r=new Map(t.map(a=>[a.id,a])),s=new Set,n=[...e];for(;n.length>0;){let a=n.shift();if(s.has(a))continue;let o=r.get(a);if(!o)continue;s.add(a);let l=(i=o.metadata.links)!=null?i:[];for(let c of l)r.has(c)&&!s.has(c)&&n.push(c)}return Array.from(s)}findPathToGoal(t,e,r=5){var o;let s=new Map(t.map(l=>[l.id,l]));if(!s.get(e))return[];let i=new Set,a=[{id:e,depth:0}];for(;a.length>0;){let{id:l,depth:c}=a.shift();if(i.has(l)&&l!==e||(i.add(l),c>=r))continue;let p=s.get(l);if(!p)continue;let g=(o=p.metadata.links)!=null?o:[];for(let u of g)s.has(u)&&!i.has(u)&&a.push({id:u,depth:c+1})}return Array.from(i)}extractDependencies(t,e){var n;let r=new Set(e),s=[];for(let i of t){if(!r.has(i.id))continue;let a=(n=i.metadata.links)!=null?n:[];for(let o of a)r.has(o)&&o!==i.id&&s.push(x.prerequisite(i.id,o,.7))}return s}sortWithCycleFallback(t,e){var o,l,c,p;let r=new Map,s=new Map;for(let g of t)r.set(g,0),s.set(g,[]);for(let g of e)g.isPrerequisite()&&((o=s.get(g.sourceId))==null||o.push(g.targetId));for(let[,g]of s)for(let u of g)r.set(u,((l=r.get(u))!=null?l:0)+1);let n=[],i=[];for(let[g,u]of r)u===0&&i.push(g);let a=new Set;for(;i.length>0;){i.sort();let g=i.shift();if(!a.has(g)){a.add(g),n.push(g);for(let u of(c=s.get(g))!=null?c:[]){let v=((p=r.get(u))!=null?p:1)-1;r.set(u,v),v===0&&!a.has(u)&&i.push(u)}}}for(let g of t)a.has(g)||n.push(g);return n}generateId(){return`path-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}};var F=class{constructor(t,e){this.pathRepository=t;this.progressRepository=e}async execute(t){try{let e=await this.pathRepository.findById(t.pathId);if(!e)return{success:!1,error:`Path '${t.pathId}' not found`};if(!e.getNode(t.nodeId))return{success:!1,error:`Node '${t.nodeId}' not found in path`};let s=this.valueToMasteryLevel(t.newLevel),n=e.updateNodeProgress(t.nodeId,s);await this.progressRepository.updateProgress(t.nodeId,s),(t.newLevel==="in_progress"||t.newLevel==="completed")&&await this.progressRepository.updateLastStudied(t.nodeId,new Date),t.newLevel==="completed"&&await this.progressRepository.incrementStudyCount(t.nodeId),await this.pathRepository.save(n);let i=n.getStatistics(),a=this.getNextRecommendedNodes(n);return{success:!0,statistics:i.toObject(),nextRecommendedNodes:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}valueToMasteryLevel(t){switch(t){case"not_started":return y.notStarted();case"in_progress":return y.inProgress();case"completed":return y.completed();default:return y.notStarted()}}getNextRecommendedNodes(t){let e=t.getCurrentNode();if(!e)return[];let s=t.getNotStartedNodes().slice(0,3).map(n=>n.noteId);return e.isInProgress()?[e.noteId,...s.filter(n=>n!==e.noteId)].slice(0,3):s}};var ee=class{constructor(t){this.providers=new Map;this.settings=t}registerProvider(t,e){this.providers.set(t,e);let r=this.settings.apiKeys[t];r&&e.setApiKey(r);let s=f[t],n=this.settings.models[t]||s.defaultModel;e.setModel(n)}getProvider(t){return this.providers.get(t)}getCurrentProvider(){return this.providers.get(this.settings.provider)}updateSettings(t){this.settings=t;for(let[e,r]of this.providers){let s=this.settings.apiKeys[e];s&&r.setApiKey(s);let n=f[e],i=this.settings.models[e]||n.defaultModel;r.setModel(i)}}isAvailable(){var e;if(!this.settings.enabled)return!1;let t=this.getCurrentProvider();return(e=t==null?void 0:t.isAvailable())!=null?e:!1}async generate(t,e){let r=this.getCurrentProvider();return r?r.isAvailable()?r.generate(t,e):{success:!1,content:"",error:"API key not configured."}:{success:!1,content:"",error:"No provider selected."}}async simpleGenerate(t,e,r){let s=[];return e&&s.push({role:"system",content:e}),s.push({role:"user",content:t}),this.generate(s,r)}async testApiKey(t,e){let r=this.providers.get(t);return r?r.testApiKey(e):!1}async analyzeDependencies(t,e){let r=this.getCurrentProvider();return!r||!r.isAvailable()?{success:!1,error:"Provider not available."}:r.analyzeDependencies(t,e)}async identifyKnowledgeGaps(t,e){let r=this.getCurrentProvider();return!r||!r.isAvailable()?{success:!1,error:"Provider not available."}:r.identifyKnowledgeGaps(t,e)}async suggestLearningOrder(t,e){let r=this.getCurrentProvider();return!r||!r.isAvailable()?{success:!1,error:"Provider not available."}:r.suggestLearningOrder(t,e)}async analyzeNotesForLearningPath(t,e){let r=this.getCurrentProvider();return!r||!r.isAvailable()?{success:!1,error:"Provider not available."}:r.analyzeNotesForLearningPath(t,e)}async extractPrerequisiteConcepts(t){let e=this.getCurrentProvider();return!e||!e.isAvailable()?{success:!1,error:"Provider not available."}:e.extractPrerequisiteConcepts(t)}},ge=null;function ie(d){return ge=new ee(d),ge}function ae(){ge=null}var Me={maxQueryLength:8e3},oe=class{constructor(t,e,r){this.embeddingProvider=t;this.vectorStore=e;this.config={...Me,...r}}isAvailable(){return this.embeddingProvider.isAvailable()&&this.vectorStore.size()>0}async findSimilar(t,e){if(!this.embeddingProvider.isAvailable())return console.warn("[EmbeddingService] Query embedding provider not available"),[];if(this.vectorStore.size()===0)return console.warn("[EmbeddingService] No embeddings available. Run Vault Embeddings plugin first."),[];try{let r=this.prepareQuery(t),s=await this.embeddingProvider.embed(r);return this.vectorStore.search(s,e).map(i=>({noteId:i.noteId,notePath:i.notePath,similarity:i.similarity}))}catch(r){return console.error("[EmbeddingService] Search failed:",r),[]}}hasEmbedding(t){return this.vectorStore.has(t)}getEmbeddingCount(){return this.vectorStore.size()}getStoredNoteIds(){return this.vectorStore.getStoredNoteIds()}prepareQuery(t){return t.replace(/\s+/g," ").trim().slice(0,this.config.maxQueryLength)}},ue=null;function he(d,t,e){return ue=new oe(d,t,e),ue}function le(){ue=null}var k=require("obsidian");function De(d){let t=0;for(let e=0;e<d.length;e++){let r=d.charCodeAt(e);t=(t<<5)-t+r,t=t&t}return Math.abs(t).toString(16).padStart(8,"0")}function D(d){let t=d.replace(/\.md$/,"");return De(t)}var U=class{constructor(t){this.app=t}async getNote(t){let r=this.app.vault.getMarkdownFiles().find(s=>D(s.path)===t);return r?this.fileToNoteData(r):null}async getNoteByPath(t){let e=(0,k.normalizePath)(t),r=this.app.vault.getAbstractFileByPath(e);return!r||!(r instanceof k.TFile)?null:this.fileToNoteData(r)}async getLinkedNotes(t){let e=await this.getNote(t);if(!e||!e.metadata.links)return[];let r=[];for(let s of e.metadata.links){let n=await this.getNote(s);n&&r.push(n)}return r}async getBacklinks(t){let e=await this.getNote(t);if(!e||!e.metadata.backlinks)return[];let r=[];for(let s of e.metadata.backlinks){let n=await this.getNote(s);n&&r.push(n)}return r}async getNotesByTag(t){var n;let e=this.app.vault.getMarkdownFiles(),r=[],s=t.startsWith("#")?t:`#${t}`;for(let i of e){let a=this.app.metadataCache.getFileCache(i);if(!a)continue;if(((n=(0,k.getAllTags)(a))!=null?n:[]).includes(s)){let l=await this.fileToNoteData(i);l&&r.push(l)}}return r}async getAllNotes(t){let e=this.app.vault.getMarkdownFiles();if(console.log(`[NoteRepository] Total markdown files in vault: ${e.length}`),t!=null&&t.folder){let s=(0,k.normalizePath)(t.folder),n=s.endsWith("/")?s:`${s}/`;e=e.filter(i=>i.path.startsWith(n)),console.log(`[NoteRepository] After folder filter (${t.folder}): ${e.length}`)}if(t!=null&&t.excludeFolders&&t.excludeFolders.length>0){let s=e.length;e=e.filter(n=>!t.excludeFolders.some(i=>{let a=(0,k.normalizePath)(i),o=a.endsWith("/")?a:`${a}/`;return n.path.startsWith(o)})),console.log(`[NoteRepository] After excludeFolders filter: ${e.length} (excluded ${s-e.length})`)}let r=[];for(let s of e){let n=await this.fileToNoteData(s);n&&r.push(n)}return console.log(`[NoteRepository] Final notes count: ${r.length}`),r}async exists(t){return this.app.vault.getMarkdownFiles().some(r=>D(r.path)===t)}async searchNotes(t,e){let r=await this.getAllNotes({excludeFolders:e==null?void 0:e.excludeFolders}),s=t.toLowerCase(),n=[];for(let i of r){let a=i.basename.toLowerCase().includes(s),o=i.content.toLowerCase().includes(s);if((a||o)&&n.push(i),e!=null&&e.limit&&n.length>=e.limit)break}return n}async fileToNoteData(t){var e;try{let r=await this.app.vault.read(t),s=this.app.metadataCache.getFileCache(t);return{id:D(t.path),path:t.path,basename:t.basename,content:r,metadata:{tags:this.extractTags(s),links:this.extractLinks(s),backlinks:this.extractBacklinks(t),frontmatter:(e=s==null?void 0:s.frontmatter)!=null?e:{}}}}catch(r){return console.error(`Error reading file ${t.path}:`,r),null}}extractTags(t){var e;return t?(e=(0,k.getAllTags)(t))!=null?e:[]:[]}extractLinks(t){return t!=null&&t.links?t.links.map(e=>{var n;let r=e.link;return((n=r.split("/").pop())!=null?n:r).replace(/\.md$/,"")}).filter((e,r,s)=>s.indexOf(e)===r):[]}extractBacklinks(t){let e=[],r=this.app.metadataCache.resolvedLinks;for(let[s,n]of Object.entries(r))if(n[t.path]){let i=this.app.vault.getAbstractFileByPath(s);i instanceof k.TFile&&e.push(i.basename)}return e}};var T=require("obsidian");var K=class{constructor(t,e){this.app=t;var r;this.config={storagePath:(r=e==null?void 0:e.storagePath)!=null?r:"_learning-paths"}}async save(t){console.log("[PathRepository] save() called with path id:",t.id),await this.ensureStorageFolder();let e=this.getFilePath(t.id),r=t.toData(),s=JSON.stringify(r,null,2);console.log("[PathRepository] Saving to:",e);try{let n=this.app.vault.getAbstractFileByPath(e);n&&n instanceof T.TFile?(await this.app.vault.modify(n,s),console.log("[PathRepository] Modified existing file")):(await this.app.vault.create(e,s),console.log("[PathRepository] Created new file"))}catch(n){throw console.error("[PathRepository] Save failed:",n),n}}async findById(t){let e=this.getFilePath(t);console.log("[PathRepository] findById() looking for:",e);let r=this.app.vault.getAbstractFileByPath(e);if(!r||!(r instanceof T.TFile))return console.log("[PathRepository] File not found:",e),null;try{let s=await this.app.vault.read(r),n=JSON.parse(s);return console.log("[PathRepository] Successfully loaded path"),M.fromData(n)}catch(s){return console.error(`[PathRepository] Error reading path file ${e}:`,s),null}}async findByGoalNote(t){var r;return(r=(await this.findAll()).find(s=>s.goalNoteId===t))!=null?r:null}async findAll(){await this.ensureStorageFolder();let t=this.app.vault.getAbstractFileByPath(this.config.storagePath);if(!t||!(t instanceof T.TFolder))return[];let e=[];for(let r of t.children)if(r instanceof T.TFile&&r.extension==="json")try{let s=await this.app.vault.read(r),n=JSON.parse(s);e.push(M.fromData(n))}catch(s){console.error(`Error reading path file ${r.path}:`,s)}return e}async delete(t){let e=this.getFilePath(t),r=this.app.vault.getAbstractFileByPath(e);r&&r instanceof T.TFile&&await this.app.vault.delete(r)}async exists(t){let e=this.getFilePath(t),r=this.app.vault.getAbstractFileByPath(e);return r!==null&&r instanceof T.TFile}getFilePath(t){let e=t.replace(/[^a-zA-Z0-9-_]/g,"_");return`${this.config.storagePath}/${e}.json`}async ensureStorageFolder(){if(!this.app.vault.getAbstractFileByPath(this.config.storagePath))try{await this.app.vault.createFolder(this.config.storagePath)}catch(e){if(!(e instanceof Error)||!e.message.includes("Folder already exists"))throw e}}};var V=class{constructor(t,e){this.app=t;var r,s,n;this.config={masteryLevelKey:(r=e==null?void 0:e.masteryLevelKey)!=null?r:"learning_mastery",lastStudiedKey:(s=e==null?void 0:e.lastStudiedKey)!=null?s:"learning_last_studied",studyCountKey:(n=e==null?void 0:e.studyCountKey)!=null?n:"learning_study_count"}}async getProgress(t){let e=await this.getFileByNoteId(t);if(!e)return y.notStarted();let r=this.app.metadataCache.getFileCache(e),s=r==null?void 0:r.frontmatter;if(!s)return y.notStarted();let n=s[this.config.masteryLevelKey];return this.parseLevel(n)}async updateProgress(t,e){let r=await this.getFileByNoteId(t);if(!r){console.warn(`Note not found: ${t}`);return}await this.updateFrontmatter(r,{[this.config.masteryLevelKey]:e.toString()})}async getLastStudied(t){let e=await this.getFileByNoteId(t);if(!e)return null;let r=this.app.metadataCache.getFileCache(e),s=r==null?void 0:r.frontmatter;if(!s)return null;let n=s[this.config.lastStudiedKey];if(!n)return null;let i=new Date(n);return isNaN(i.getTime())?null:i}async updateLastStudied(t,e){let r=await this.getFileByNoteId(t);if(!r){console.warn(`Note not found: ${t}`);return}await this.updateFrontmatter(r,{[this.config.lastStudiedKey]:this.formatDateTime(e)})}formatDateTime(t){let e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");return`${e}-${r}-${s} ${n}:${i}:${a}`}async incrementStudyCount(t){var n,i;let e=await this.getFileByNoteId(t);if(!e){console.warn(`Note not found: ${t}`);return}let r=this.app.metadataCache.getFileCache(e),s=(i=(n=r==null?void 0:r.frontmatter)==null?void 0:n[this.config.studyCountKey])!=null?i:0;await this.updateFrontmatter(e,{[this.config.studyCountKey]:s+1})}async getBulkProgress(t){let e=new Map;for(let r of t){let s=await this.getProgress(r);e.set(r,s)}return e}async resetProgress(t){let e=await this.getFileByNoteId(t);e&&await this.updateFrontmatter(e,{[this.config.masteryLevelKey]:"not_started",[this.config.lastStudiedKey]:null,[this.config.studyCountKey]:0})}async resetAllProgress(){let t=this.app.vault.getMarkdownFiles();for(let e of t){let r=this.app.metadataCache.getFileCache(e),s=r==null?void 0:r.frontmatter;s!=null&&s[this.config.masteryLevelKey]&&await this.updateFrontmatter(e,{[this.config.masteryLevelKey]:"not_started",[this.config.lastStudiedKey]:null,[this.config.studyCountKey]:0})}}async getFileByNoteId(t){var r;return(r=this.app.vault.getMarkdownFiles().find(s=>D(s.path)===t))!=null?r:null}parseLevel(t){if(typeof t!="string")return y.notStarted();switch(t){case"in_progress":return y.inProgress();case"completed":return y.completed();default:return y.notStarted()}}async updateFrontmatter(t,e){await this.app.fileManager.processFrontMatter(t,r=>{for(let[s,n]of Object.entries(e))n===null?delete r[s]:r[s]=n})}};var Pe=require("obsidian");var A=class{constructor(){this.apiKey="";this.model=""}get modelId(){return this.model}setApiKey(t){this.apiKey=t}setModel(t){this.model=t}isAvailable(){return!!this.apiKey&&this.apiKey.length>0}async simpleGenerate(t,e,r){let s=[];return e&&s.push({role:"system",content:e}),s.push({role:"user",content:t}),this.generate(s,r)}async makeRequest(t){try{return(await(0,Pe.requestUrl)(t)).json}catch(e){throw this.normalizeError(e)}}normalizeError(t){if(t instanceof Error){let e=t.message.toLowerCase();return e.includes("401")||e.includes("unauthorized")||e.includes("invalid api key")?new Error("Authentication failed: Invalid API key."):e.includes("429")||e.includes("rate limit")?new Error("Rate limit exceeded: Please try again later."):e.includes("timeout")||e.includes("timed out")?new Error("Request timeout: Please check your network connection."):e.includes("500")||e.includes("internal server")?new Error("Server error: Please try again later."):t}return new Error("An unknown error occurred.")}handleError(t){return{success:!1,content:"",error:this.normalizeError(t).message}}async analyzeDependencies(t,e){let r=this.buildDependencyAnalysisPrompt(t,e),s=await this.simpleGenerate(r);return s.success?{success:!0,data:this.parseDependencyResponse(s.content||""),rawResponse:s.content}:{success:!1,error:s.error}}async identifyKnowledgeGaps(t,e){let r=this.buildKnowledgeGapPrompt(t,e),s=await this.simpleGenerate(r);return s.success?{success:!0,data:this.parseKnowledgeGapResponse(s.content||""),rawResponse:s.content}:{success:!1,error:s.error}}async suggestLearningOrder(t,e){let r=this.buildLearningOrderPrompt(t,e),s=await this.simpleGenerate(r);return s.success?{success:!0,data:this.parseLearningOrderResponse(s.content||""),rawResponse:s.content}:{success:!1,error:s.error}}async analyzeNotesForLearningPath(t,e){let r=this.buildLearningPathPrompt(t,e),s=await this.simpleGenerate(r);return s.success?{success:!0,data:this.parseLearningPathResponse(s.content||"",t.title,e.map(i=>i.title)),rawResponse:s.content}:{success:!1,error:s.error}}async extractPrerequisiteConcepts(t){let e=this.buildConceptExtractionPrompt(t),r=await this.simpleGenerate(e);return r.success?{success:!0,data:this.parseConceptExtractionResponse(r.content||"",t.title),rawResponse:r.content}:{success:!1,error:r.error}}buildDependencyAnalysisPrompt(t,e){let r=e.map((s,n)=>`[Linked Note ${n+1}]
${s.slice(0,500)}`).join(`

`);return`Please analyze the conceptual dependencies of the following note.

[Target Note]
${t.slice(0,2e3)}

${r?`[Linked Notes]
${r}`:""}

Respond in JSON format:
\`\`\`json
{
  "dependencies": [
    {"source": "ConceptA", "target": "ConceptB", "type": "prerequisite", "confidence": 0.8}
  ],
  "concepts": ["extracted core concepts"],
  "confidence": 0.85
}
\`\`\``}buildKnowledgeGapPrompt(t,e){return`Please analyze the learning path and identify knowledge gaps.

[Learning Path]
${t}

[Concepts in Vault]
${e.join(", ")}

Respond in JSON format:
\`\`\`json
{
  "gaps": [
    {"concept": "missing concept", "reason": "why it's needed", "priority": "high"}
  ],
  "summary": "analysis summary"
}
\`\`\``}buildLearningOrderPrompt(t,e){let r=e.map(s=>`${s.sourceId} \u2192 ${s.targetId}`).join(`
`);return`Please suggest the optimal learning order for the following concepts.

[Concepts]
${t.join(", ")}

[Known Dependencies]
${r||"None"}

Respond with a JSON array of learning order:
\`\`\`json
["first concept to learn", "second", ...]
\`\`\``}buildLearningPathPrompt(t,e){let r=e.map(n=>`### ${n.title}
${n.content.slice(0,1500)}`).join(`

`),s=e.map(n=>n.title).join(", ");return`You are an educational expert who designs learning paths.

## Goal
Suggest the optimal learning order to fully understand the "${t.title}" note,
and **identify knowledge gaps that are necessary for deep understanding but not currently in the vault**.

## Goal Note Content
${t.content.slice(0,2e3)}

## Related Notes (currently in vault)
${r}

## Analysis Request
Analyze the above notes and respond in JSON format:

\`\`\`json
{
  "learningOrder": ["first note to learn", "next note", ..., "${t.title}"],
  "dependencies": [
    {"from": "prerequisite note", "to": "dependent note", "reason": "reason"}
  ],
  "estimatedMinutes": {
    "noteTitle": estimatedMinutes
  },
  "knowledgeGaps": [
    {
      "concept": "missing concept/topic",
      "reason": "why this concept is needed",
      "priority": "high|medium|low",
      "suggestedResources": ["recommended resources (books, courses, keywords, etc.)"]
    }
  ]
}
\`\`\`

## Important Rules

### Learning Order (learningOrder)
1. Sort from foundational concepts to advanced concepts
2. Goal note ("${t.title}") must be placed last
3. Related notes unnecessary for goal achievement can be excluded
4. Estimated learning time ranges from 5-60 minutes based on note complexity

### Knowledge Gap Analysis (knowledgeGaps) - Very Important!
1. **Identify concepts essential for deep understanding of the goal note but not currently in the vault**
2. Notes currently in vault: ${s}
3. Knowledge gap examples:
   - If goal note is "Measurement Problem in Quantum Mechanics" but vault lacks "Probabilistic Interpretation" note \u2192 gap
   - If goal note is "AI Ethics" but vault lacks "Trolley Problem" note \u2192 gap
4. Priority criteria:
   - high: Understanding the goal note is difficult without this concept
   - medium: Helpful for understanding but not essential
   - low: Good to know for advanced learning
5. suggestedResources: Suggest specific learning materials like search keywords, related books, online courses`}buildConceptExtractionPrompt(t){return`You are an expert in knowledge graphs and learning design.

## Goal
Extract **prerequisite concepts that must be known** to fully understand the "${t.title}" note.

## Note Content
${t.content.slice(0,3e3)}

## Analysis Request
Please respond in JSON format with background knowledge and prerequisite concepts needed to deeply understand this note:

\`\`\`json
{
  "mainTopic": "The core topic this note covers (one sentence)",
  "prerequisites": [
    {
      "concept": "prerequisite concept name",
      "description": "why this concept is needed (1-2 sentences)",
      "importance": "essential|helpful|optional"
    }
  ],
  "keywords": ["related keywords for semantic search"]
}
\`\`\`

## Important Rules
1. **Prerequisites**:
   - essential: Understanding the note content is difficult without this concept
   - helpful: Helps with understanding but not essential
   - optional: Related concepts for advanced learning

2. **Be Specific**:
   - Instead of broad concepts like "philosophy", use specific ones like "Plato's Theory of Forms", "Kant's Synthetic A Priori"
   - Instead of "programming", use specific concepts like "recursive functions", "tree data structures"

3. **Keywords**:
   - Specific words/phrases that can be used for note search
   - Include similar concepts and related terms

4. **Quantity Limits**:
   - prerequisites: 3-10 (only the most important)
   - keywords: 5-15`}parseDependencyResponse(t){try{let e=t.match(/```json\s*([\s\S]*?)\s*```/);if(e){let r=JSON.parse(e[1]);return{dependencies:(r.dependencies||[]).map(s=>x.prerequisite(s.source,s.target,s.confidence||.7)),concepts:r.concepts||[],confidence:r.confidence||.5}}}catch(e){console.error("Failed to parse dependency response:",e)}return{dependencies:[],concepts:[],confidence:0}}parseKnowledgeGapResponse(t){try{let e=t.match(/```json\s*([\s\S]*?)\s*```/);if(e){let r=JSON.parse(e[1]);return{gaps:(r.gaps||[]).map(s=>B.create({concept:s.concept,description:s.reason||"",suggestedResources:[],priority:s.priority||"medium"})),summary:r.summary||""}}}catch(e){console.error("Failed to parse knowledge gap response:",e)}return{gaps:[],summary:""}}parseLearningOrderResponse(t){try{let e=t.match(/```json\s*([\s\S]*?)\s*```/);if(e)return JSON.parse(e[1])}catch(e){console.error("Failed to parse learning order response:",e)}return[]}parseLearningPathResponse(t,e,r){try{let n=t.match(/```json\s*([\s\S]*?)\s*```/);if(n){let i=JSON.parse(n[1]),a=[...r,e],o=i.learningOrder.filter(p=>a.includes(p));if(!o.includes(e))o.push(e);else if(o[o.length-1]!==e){let p=o.indexOf(e);o.splice(p,1),o.push(e)}let c=(i.knowledgeGaps||[]).map(p=>typeof p=="string"?{concept:p,reason:"",priority:"medium",suggestedResources:[]}:{concept:p.concept||"",reason:p.reason||"",priority:p.priority||"medium",suggestedResources:p.suggestedResources||[]});return{learningOrder:o,dependencies:i.dependencies||[],estimatedMinutes:i.estimatedMinutes||{},knowledgeGaps:c}}}catch(n){console.error("Failed to parse LLM response:",n)}let s=r.filter(n=>n!==e);return s.push(e),{learningOrder:s,dependencies:[],estimatedMinutes:{},knowledgeGaps:[]}}parseConceptExtractionResponse(t,e){try{let r=t.match(/```json\s*([\s\S]*?)\s*```/);if(r){let s=JSON.parse(r[1]);return{mainTopic:s.mainTopic||e,prerequisites:(s.prerequisites||[]).map(n=>({concept:n.concept||"",description:n.description||"",importance:n.importance||"helpful"})),keywords:s.keywords||[]}}}catch(r){console.error("Failed to parse concept extraction response:",r)}return{mainTopic:e,prerequisites:[],keywords:[]}}};var j=class extends A{constructor(){super();this.name="Anthropic Claude";this.providerType="claude";this.API_VERSION="2023-06-01";this.model=f.claude.defaultModel}async generate(e,r){var s,n;if(!this.isAvailable())return{success:!1,content:"",error:"API key not configured."};try{let{claudeMessages:i,systemPrompt:a}=this.convertMessages(e),o={model:this.model,max_tokens:(r==null?void 0:r.maxTokens)||4096,messages:i};a&&(o.system=a),(r==null?void 0:r.temperature)!==void 0&&(o.temperature=r.temperature),(r==null?void 0:r.topP)!==void 0&&(o.top_p=r.topP),r!=null&&r.stopSequences&&(o.stop_sequences=r.stopSequences);let l=await this.makeRequest({url:`${f.claude.endpoint}/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify(o)});return l.error?{success:!1,content:"",error:l.error.message}:{success:!0,content:((n=(s=l.content)==null?void 0:s[0])==null?void 0:n.text)||"",usage:l.usage?{inputTokens:l.usage.input_tokens,outputTokens:l.usage.output_tokens,totalTokens:l.usage.input_tokens+l.usage.output_tokens}:void 0}}catch(i){return this.handleError(i)}}async testApiKey(e){try{let r=await this.makeRequest({url:`${f.claude.endpoint}/messages`,method:"POST",headers:{"x-api-key":e,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify({model:this.model||f.claude.defaultModel,max_tokens:10,messages:[{role:"user",content:"Hello"}]})});return!r.error&&!!r.content}catch(r){return!1}}convertMessages(e){let r=null,s=[];for(let n of e)n.role==="system"?r=r?`${r}

${n.content}`:n.content:s.push({role:n.role,content:n.content});return{claudeMessages:s,systemPrompt:r}}};var H=class extends A{constructor(){super();this.name="OpenAI GPT";this.providerType="openai";this.model=f.openai.defaultModel}async generate(e,r){var s,n,i;if(!this.isAvailable())return{success:!1,content:"",error:"API key not configured."};try{let a=e.map(g=>({role:g.role,content:g.content})),o=this.model.startsWith("o1")||this.model.startsWith("o3")||this.model.startsWith("gpt-5"),l={model:this.model,messages:a};o?l.max_completion_tokens=(r==null?void 0:r.maxTokens)||4096:(l.max_tokens=(r==null?void 0:r.maxTokens)||4096,(r==null?void 0:r.temperature)!==void 0&&(l.temperature=r.temperature),(r==null?void 0:r.topP)!==void 0&&(l.top_p=r.topP)),r!=null&&r.stopSequences&&(l.stop=r.stopSequences);let c=await this.makeRequest({url:`${f.openai.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(l)});return c.error?{success:!1,content:"",error:c.error.message}:{success:!0,content:((i=(n=(s=c.choices)==null?void 0:s[0])==null?void 0:n.message)==null?void 0:i.content)||"",usage:c.usage?{inputTokens:c.usage.prompt_tokens,outputTokens:c.usage.completion_tokens,totalTokens:c.usage.total_tokens}:void 0}}catch(a){return this.handleError(a)}}async testApiKey(e){var r;try{let s=this.model||f.openai.defaultModel,n=s.startsWith("o1")||s.startsWith("o3")||s.startsWith("gpt-5"),i={model:s,messages:[{role:"user",content:"Hello"}]};n?i.max_completion_tokens=10:i.max_tokens=10;let a=await this.makeRequest({url:`${f.openai.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)});return!a.error&&((r=a.choices)==null?void 0:r.length)>0}catch(s){return!1}}};var W=class extends A{constructor(){super();this.name="Google Gemini";this.providerType="gemini";this.model=f.gemini.defaultModel}async generate(e,r){var s,n,i,a,o;if(!this.isAvailable())return{success:!1,content:"",error:"API key not configured."};try{let{contents:l,systemInstruction:c}=this.convertMessages(e),p={contents:l,generationConfig:{maxOutputTokens:(r==null?void 0:r.maxTokens)||4096}};c&&(p.systemInstruction=c),(r==null?void 0:r.temperature)!==void 0&&(p.generationConfig.temperature=r.temperature),(r==null?void 0:r.topP)!==void 0&&(p.generationConfig.topP=r.topP),r!=null&&r.stopSequences&&(p.generationConfig.stopSequences=r.stopSequences);let g=`${f.gemini.endpoint}/models/${this.model}:generateContent?key=${this.apiKey}`,u=await this.makeRequest({url:g,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});return u.error?{success:!1,content:"",error:u.error.message}:{success:!0,content:((o=(a=(i=(n=(s=u.candidates)==null?void 0:s[0])==null?void 0:n.content)==null?void 0:i.parts)==null?void 0:a[0])==null?void 0:o.text)||"",usage:u.usageMetadata?{inputTokens:u.usageMetadata.promptTokenCount,outputTokens:u.usageMetadata.candidatesTokenCount,totalTokens:u.usageMetadata.totalTokenCount}:void 0}}catch(l){return this.handleError(l)}}async testApiKey(e){var r;try{let s=`${f.gemini.endpoint}/models/${this.model||f.gemini.defaultModel}:generateContent?key=${e}`,n=await this.makeRequest({url:s,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{maxOutputTokens:10}})});return!n.error&&!!((r=n.candidates)!=null&&r.length)}catch(s){return!1}}convertMessages(e){let r=null,s=[];for(let n of e)n.role==="system"?r?r.parts.push({text:n.content}):r={parts:[{text:n.content}]}:s.push({role:n.role==="assistant"?"model":"user",parts:[{text:n.content}]});return{contents:s,systemInstruction:r}}};var J=class extends A{constructor(){super();this.name="xAI Grok";this.providerType="grok";this.model=f.grok.defaultModel}async generate(e,r){var s,n,i;if(!this.isAvailable())return{success:!1,content:"",error:"API key not configured."};try{let a=e.map(p=>({role:p.role,content:p.content})),o={model:this.model,messages:a,max_tokens:(r==null?void 0:r.maxTokens)||4096};(r==null?void 0:r.temperature)!==void 0&&(o.temperature=r.temperature),(r==null?void 0:r.topP)!==void 0&&(o.top_p=r.topP),r!=null&&r.stopSequences&&(o.stop=r.stopSequences);let l=await this.makeRequest({url:`${f.grok.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(o)});return l.error?{success:!1,content:"",error:l.error.message}:{success:!0,content:((i=(n=(s=l.choices)==null?void 0:s[0])==null?void 0:n.message)==null?void 0:i.content)||"",usage:l.usage?{inputTokens:l.usage.prompt_tokens,outputTokens:l.usage.completion_tokens,totalTokens:l.usage.total_tokens}:void 0}}catch(a){return this.handleError(a)}}async testApiKey(e){var r;try{let s=await this.makeRequest({url:`${f.grok.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model||f.grok.defaultModel,max_tokens:10,messages:[{role:"user",content:"Hello"}]})});return!s.error&&((r=s.choices)==null?void 0:r.length)>0}catch(s){return!1}}};var me=require("obsidian"),we="https://api.openai.com/v1/embeddings",ke="text-embedding-3-small",Ce=1536,Q=class{constructor(t,e,r){this.apiKey=t,this.model=e!=null?e:ke,this.dimensions=r!=null?r:Ce}isAvailable(){return!!this.apiKey&&this.apiKey.length>0}getDimensions(){return this.dimensions}async embed(t){var r,s;if(!this.isAvailable())throw new Error("[OpenAIEmbeddingProvider] API key not configured");let e=this.cleanText(t);if(!e)throw new Error("[OpenAIEmbeddingProvider] Empty text provided");try{let n=await(0,me.requestUrl)({url:we,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,input:e,dimensions:this.dimensions})});if(n.status!==200){let a=n.text||"No response body";throw console.error("[OpenAIEmbeddingProvider] API error response:",a),new Error(`OpenAI API error ${n.status}: ${a.slice(0,200)}`)}if(!n.text||n.text.length===0)throw new Error("OpenAI API returned empty response");let i=n.json;if(!((s=(r=i==null?void 0:i.data)==null?void 0:r[0])!=null&&s.embedding))throw new Error(`Invalid API response structure: ${JSON.stringify(i).slice(0,200)}`);return i.data[0].embedding}catch(n){let i=n instanceof Error?n.message:String(n);throw console.error("[OpenAIEmbeddingProvider] Embedding failed:",i),new Error(`Embedding failed: ${i}`)}}async embedBatch(t){if(!this.isAvailable())throw new Error("[OpenAIEmbeddingProvider] API key not configured");let e=t.map(n=>this.cleanText(n)),r=[],s=[];for(let n=0;n<e.length;n++)e[n].length>0&&(r.push(n),s.push(e[n]));if(s.length===0)return t.map(()=>[]);try{let n=await(0,me.requestUrl)({url:we,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,input:s,dimensions:this.dimensions})});if(n.status!==200)throw new Error(`OpenAI API error: ${n.status}`);let a=n.json.data.sort((l,c)=>l.index-c.index).map(l=>l.embedding),o=t.map(()=>[]);for(let l=0;l<r.length;l++)o[r[l]]=a[l];return o}catch(n){throw console.error("[OpenAIEmbeddingProvider] Batch embedding failed:",n),n}}cleanText(t){return t.replace(/\s+/g," ").trim().slice(0,8e3)}};var $=require("obsidian"),_e=10,Te=.3,Ge=6e4,Y=class{constructor(t,e){this.cache=new Map;this.indexCache=null;this.lastCacheUpdate=0;this.initialized=!1;var r,s;this.app=t,this.config={storagePath:(r=e==null?void 0:e.storagePath)!=null?r:"09_Embedded",embeddingsFolder:(s=e==null?void 0:e.embeddingsFolder)!=null?s:"embeddings"}}async initialize(){if(!this.initialized)try{await this.loadAllEmbeddings(),this.initialized=!0,console.log(`[VaultEmbeddingsVectorStore] Initialized with ${this.cache.size} embeddings`)}catch(t){console.error("[VaultEmbeddingsVectorStore] Initialization failed:",t),this.initialized=!0}}isAvailable(){return this.cache.size>0}async getStats(){var t,e;return await this.ensureCacheValid(),{isAvailable:this.isAvailable(),totalEmbeddings:this.cache.size,model:(e=(t=this.indexCache)==null?void 0:t.model)!=null?e:"unknown",provider:"openai"}}async refresh(){this.cache.clear(),this.indexCache=null,this.lastCacheUpdate=0,await this.loadAllEmbeddings(),console.log(`[VaultEmbeddingsVectorStore] Cache refreshed: ${this.cache.size} embeddings`)}store(t){console.info("[VaultEmbeddingsVectorStore] store() is no-op. Use Vault Embeddings plugin to manage embeddings.")}search(t,e){var a,o,l;let r=(a=e==null?void 0:e.limit)!=null?a:_e,s=(o=e==null?void 0:e.threshold)!=null?o:Te,n=new Set((l=e==null?void 0:e.excludeNoteIds)!=null?l:[]),i=[];for(let[c,p]of this.cache){if(n.has(c)||t.length!==p.vector.length)continue;let g=this.cosineSimilarity(t,p.vector);g>=s&&i.push({noteId:c,notePath:p.notePath,similarity:g})}return i.sort((c,p)=>p.similarity-c.similarity).slice(0,r)}getStoredNoteIds(){return Array.from(this.cache.keys())}remove(t){console.info("[VaultEmbeddingsVectorStore] remove() is no-op. Use Vault Embeddings plugin to manage embeddings.")}clear(){console.info("[VaultEmbeddingsVectorStore] clear() is no-op. Use Vault Embeddings plugin to manage embeddings.")}size(){return this.cache.size}has(t){return this.cache.has(t)}async ensureCacheValid(){Date.now()-this.lastCacheUpdate>Ge&&await this.loadAllEmbeddings()}async loadAllEmbeddings(){let t=(0,$.normalizePath)(`${this.config.storagePath}/index.json`);try{let e,r=this.app.vault.getAbstractFileByPath(t);if(r instanceof $.TFile)e=await this.app.vault.read(r);else try{e=await this.app.vault.adapter.read(t),console.log("[VaultEmbeddingsVectorStore] Used adapter.read for index")}catch(n){console.warn(`[VaultEmbeddingsVectorStore] Index not found: ${t}`);return}this.indexCache=JSON.parse(e);let s=(0,$.normalizePath)(`${this.config.storagePath}/${this.config.embeddingsFolder}`);this.cache.clear();for(let n of Object.keys(this.indexCache.notes)){let i=n.replace(/[^a-zA-Z0-9-_]/g,"_"),a=(0,$.normalizePath)(`${s}/${i}.json`);await this.loadEmbeddingFile(a,n)}this.lastCacheUpdate=Date.now(),console.log(`[VaultEmbeddingsVectorStore] Loaded ${this.cache.size} embeddings from Vault Embeddings`)}catch(e){console.error("[VaultEmbeddingsVectorStore] Failed to load embeddings:",e)}}async loadEmbeddingFile(t,e){try{let r,s=this.app.vault.getAbstractFileByPath(t);if(s instanceof $.TFile)r=await this.app.vault.read(s);else try{r=await this.app.vault.adapter.read(t)}catch(i){return}let n=JSON.parse(r);this.cache.set(e,{noteId:n.noteId,notePath:n.notePath,vector:n.vector,content:""})}catch(r){console.warn(`[VaultEmbeddingsVectorStore] Failed to load: ${t}`)}}cosineSimilarity(t,e){if(t.length!==e.length)return 0;let r=0,s=0,n=0;for(let a=0;a<t.length;a++)r+=t[a]*e[a],s+=t[a]*t[a],n+=e[a]*e[a];let i=Math.sqrt(s)*Math.sqrt(n);return i===0?0:r/i}};var Z=class{constructor(t){this.embeddingService=t}isAvailable(){return this.embeddingService.isAvailable()}async findSimilarToContent(t,e){var r,s;if(!this.isAvailable())return console.warn("[StandaloneSemanticSearchAdapter] Service not available"),[];try{return await this.embeddingService.findSimilar(t,{limit:(r=e==null?void 0:e.limit)!=null?r:10,threshold:(s=e==null?void 0:e.threshold)!=null?s:.3,excludeNoteIds:e==null?void 0:e.excludeNoteIds})}catch(n){return console.error("[StandaloneSemanticSearchAdapter] Search failed:",n),[]}}async findNotesForConcepts(t,e){var s,n;let r=new Map;if(!this.isAvailable()){console.warn("[StandaloneSemanticSearchAdapter] Service not available for batch search");for(let i of t)r.set(i,[]);return r}for(let i of t)try{let a=await this.findSimilarToContent(i,{limit:(s=e==null?void 0:e.limitPerConcept)!=null?s:5,threshold:(n=e==null?void 0:e.threshold)!=null?n:.3,excludeNoteIds:e==null?void 0:e.excludeNoteIds});r.set(i,a)}catch(a){console.error(`[StandaloneSemanticSearchAdapter] Failed to search concept: ${i}`,a),r.set(i,[])}return r}};var m=require("obsidian");var G="learning-path-view",te=class extends m.ItemView{constructor(e){super(e);this.currentPath=null;this.dependencies=null}setDependencies(e){this.dependencies=e}getViewType(){return G}getDisplayText(){return"Learning Path"}getIcon(){return"route"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("learning-path-view"),this.renderEmptyState(e)}async onClose(){var e;this.currentPath=null,this.dependencies=null,(e=this.containerEl.children[1])==null||e.empty()}async displayPath(e){this.currentPath=e,await this.refresh()}async refresh(){let e=this.containerEl.children[1];if(e.empty(),e.addClass("learning-path-view"),!this.currentPath){this.renderEmptyState(e);return}this.renderPath(e,this.currentPath)}renderEmptyState(e){let r=e.createDiv({cls:"learning-path-empty"}),s=r.createDiv({cls:"learning-path-empty-icon"});(0,m.setIcon)(s,"route"),r.createEl("h3",{text:"No Learning Path"}),r.createEl("p",{text:"Select a note and generate a learning path."}),r.createEl("button",{cls:"mod-cta",text:"Create New Learning Path"}).addEventListener("click",()=>this.showCreateDialog())}renderPath(e,r){var c;let s=e.createDiv({cls:"learning-path-header"});this.renderHeader(s,r);let n=e.createDiv({cls:"learning-path-stats"});this.renderStatistics(n,r.getStatistics());let i=e.createDiv({cls:"learning-path-progress"});this.renderProgressBar(i,r.getStatistics());let a=e.createDiv({cls:"learning-path-gaps"});this.renderKnowledgeGaps(a,(c=r.knowledgeGaps)!=null?c:[],r.totalAnalyzedNotes);let o=e.createDiv({cls:"learning-path-nodes"});this.renderNodes(o,r);let l=e.createDiv({cls:"learning-path-actions"});this.renderActions(l,r)}renderHeader(e,r){let s=e.createDiv({cls:"learning-path-title"}),n=s.createSpan({cls:"learning-path-title-icon"});(0,m.setIcon)(n,"target"),s.createSpan({text:r.goalNoteTitle});let i=e.createDiv({cls:"learning-path-header-actions"}),a=i.createEl("button",{cls:"learning-path-menu-btn clickable-icon",attr:{"aria-label":"Create new learning path"}});(0,m.setIcon)(a,"plus"),a.addEventListener("click",()=>this.showCreateDialog());let o=i.createEl("button",{cls:"learning-path-menu-btn clickable-icon",attr:{"aria-label":"Delete path"}});(0,m.setIcon)(o,"trash-2"),o.addEventListener("click",()=>this.deletePath(r));let l=i.createEl("button",{cls:"learning-path-menu-btn clickable-icon",attr:{"aria-label":"Close (without deleting)"}});(0,m.setIcon)(l,"x"),l.addEventListener("click",()=>this.closePath())}async closePath(){this.currentPath=null,await this.refresh()}async clearCurrentPath(){this.currentPath=null,await this.refresh()}async showLoadingState(e){let r=this.containerEl.children[1];r.empty(),r.addClass("learning-path-view"),this.renderLoadingState(r,e)}async showErrorState(e){let r=this.containerEl.children[1];r.empty(),r.addClass("learning-path-view"),this.renderErrorState(r,e)}async deletePath(e){if(!this.dependencies){new m.Notice("Error: Dependencies not set");return}try{await this.dependencies.pathRepository.delete(e.id),this.currentPath=null,await this.refresh(),new m.Notice("Learning path deleted")}catch(r){let s=r instanceof Error?r.message:"Unknown error";new m.Notice(`Delete failed: ${s}`),console.error("[LearningPathView] Delete failed:",r)}}renderStatistics(e,r){let s=[{label:"Completed",value:r.completedNodes.toString(),icon:"check-circle"},{label:"In Progress",value:r.inProgressNodes.toString(),icon:"clock"},{label:"Remaining",value:r.remainingNodes().toString(),icon:"circle"},{label:"Est. Time",value:`${r.estimatedHours()}h`,icon:"timer"}];for(let n of s){let i=e.createDiv({cls:"learning-path-stat-item"}),a=i.createSpan({cls:"learning-path-stat-icon"});(0,m.setIcon)(a,n.icon),i.createSpan({cls:"learning-path-stat-value",text:n.value}),i.createSpan({cls:"learning-path-stat-label",text:n.label})}}renderProgressBar(e,r){let s=r.progressPercent(),n=e.createDiv({cls:"learning-path-progress-label"});n.createSpan({text:"Progress"}),n.createSpan({text:`${s}%`});let a=e.createDiv({cls:"learning-path-progress-bar"}).createDiv({cls:"learning-path-progress-fill"});a.style.width=`${s}%`,s===100&&a.addClass("complete")}renderKnowledgeGaps(e,r,s){let n=e.createDiv({cls:"learning-path-gaps-header"}),i=n.createDiv({cls:"learning-path-gaps-title"}),a=i.createSpan({cls:"learning-path-gaps-icon"});(0,m.setIcon)(a,r.length>0?"alert-triangle":"check-circle"),i.createSpan({text:r.length>0?"Knowledge Gaps Found":"Knowledge Gap Analysis"});let o=n.createDiv({cls:"learning-path-gaps-stats"});if(s>0&&o.createSpan({text:r.length>0?`${s} notes analyzed \u2192 ${r.length} gaps found`:`${s} notes analyzed`,cls:"learning-path-gaps-count"}),r.length===0){e.createDiv({cls:"learning-path-gaps-empty"}).createEl("p",{text:s>0?"No knowledge gaps found. Your vault notes are sufficient for learning.":"Knowledge gap analysis was not performed. Check if AI analysis is enabled.",cls:"learning-path-gaps-empty-text"});return}let l=e.createDiv({cls:"learning-path-gaps-list"}),c=[...r].sort((g,u)=>{let v={high:0,medium:1,low:2};return v[g.priority]-v[u.priority]});for(let g of c){let u=l.createDiv({cls:`learning-path-gap-item priority-${g.priority}`}),v=u.createSpan({cls:"learning-path-gap-badge"}),h=g.priority==="high"?"Required":g.priority==="medium"?"Recommended":"Optional";v.setText(h);let b=u.createDiv({cls:"learning-path-gap-content"});if(b.createEl("strong",{text:g.concept,cls:"learning-path-gap-concept"}),g.reason&&b.createEl("p",{text:g.reason,cls:"learning-path-gap-reason"}),g.suggestedResources&&g.suggestedResources.length>0){let L=b.createDiv({cls:"learning-path-gap-resources"});L.createSpan({text:"Resources: ",cls:"learning-path-gap-resources-label"}),L.createSpan({text:g.suggestedResources.join(", "),cls:"learning-path-gap-resources-list"})}let E=u.createDiv({cls:"learning-path-gap-action"}).createEl("button",{cls:"learning-path-gap-search-btn clickable-icon",attr:{"aria-label":`Search "${g.concept}"`}});(0,m.setIcon)(E,"search"),E.addEventListener("click",()=>{var L,N,R,X;(X=(R=(N=(L=this.app.internalPlugins)==null?void 0:L.plugins)==null?void 0:N["global-search"])==null?void 0:R.instance)==null||X.openGlobalSearch(g.concept)})}e.createDiv({cls:"learning-path-gaps-help"}).createEl("p",{text:"Adding notes on these topics will make your learning more complete.",cls:"learning-path-gaps-help-text"})}renderNodes(e,r){var o,l;let s=r.nodes,n=(l=(o=this.dependencies)==null?void 0:o.getMaxDisplayNodes())!=null?l:50,i=s.slice(0,n),a=s.length-i.length;e.setAttribute("role","list"),e.setAttribute("aria-label","Learning path nodes");for(let c of i){let p=e.createDiv({cls:`learning-path-node ${this.getNodeStatusClass(c)}`,attr:{role:"listitem","aria-label":`${c.order}. ${c.title} \u2014 ${this.getNodeStatusClass(c).replace("-"," ")}`}}),g=p.createDiv({cls:"learning-path-node-status"});this.renderStatusIcon(g,c);let u=p.createDiv({cls:"learning-path-node-content"}),v=u.createDiv({cls:"learning-path-node-title"});v.createSpan({text:`${c.order}. `}),v.createEl("a",{text:c.title,cls:"internal-link"}).addEventListener("click",()=>this.openNote(c)),u.createDiv({cls:"learning-path-node-meta"}).createSpan({text:`~${c.estimatedMinutes} min`});let I=p.createDiv({cls:"learning-path-node-actions"});this.renderNodeActions(I,r,c)}a>0&&e.createDiv({cls:"learning-path-more-nodes"}).createSpan({text:`... and ${a} more nodes (adjust display count in settings)`})}getNodeStatusClass(e){return e.isCompleted()?"completed":e.isInProgress()?"in-progress":"not-started"}renderStatusIcon(e,r){let s=e.createDiv({cls:"status-icon"});r.isCompleted()?((0,m.setIcon)(s,"check-circle-2"),s.addClass("completed")):r.isInProgress()?((0,m.setIcon)(s,"clock"),s.addClass("in-progress")):((0,m.setIcon)(s,"circle"),s.addClass("not-started"))}renderNodeActions(e,r,s){if(s.isNotStarted()){let n=e.createEl("button",{cls:"learning-path-node-btn",attr:{"aria-label":"Start learning"}});(0,m.setIcon)(n,"play"),n.addEventListener("click",()=>this.updateNodeProgress(r.id,s.noteId,"in_progress"))}else if(s.isInProgress()){let n=e.createEl("button",{cls:"learning-path-node-btn",attr:{"aria-label":"Mark complete"}});(0,m.setIcon)(n,"check"),n.addEventListener("click",()=>this.updateNodeProgress(r.id,s.noteId,"completed"))}else{let n=e.createEl("button",{cls:"learning-path-node-btn",attr:{"aria-label":"Study again"}});(0,m.setIcon)(n,"rotate-ccw"),n.addEventListener("click",()=>this.updateNodeProgress(r.id,s.noteId,"not_started"))}}renderActions(e,r){if(r.isCompleted()){let s=e.createDiv({cls:"learning-path-celebrate"});s.createEl("h4",{text:"Learning Complete!"}),s.createEl("p",{text:"All nodes completed."}),e.createEl("button",{cls:"mod-warning",text:"Reset Progress"}).addEventListener("click",()=>this.resetAllProgress(r))}else{let s=e.createDiv({cls:"learning-path-continue"}),n=r.getCurrentNode();n&&(s.createEl("span",{text:"Next: "}),s.createEl("a",{text:n.title,cls:"internal-link mod-cta"}).addEventListener("click",()=>this.openNote(n)))}}async showCreateDialog(){if(!this.dependencies){console.error("Dependencies not set");return}let e=this.app.workspace.getActiveFile(),r=e?D(e.path):void 0,s=(e==null?void 0:e.basename)||"New Learning Path";if(!r||!e){new m.Notice("No active note.");return}let n=this.containerEl.children[1];n.empty(),n.addClass("learning-path-view");try{let i=await this.dependencies.pathRepository.findByGoalNote(r);if(i){await this.displayPath(i),new m.Notice(`Loaded existing learning path: ${s}`);return}this.renderLoadingState(n,s);let a={name:s,goalNoteId:r,useLLMAnalysis:!0},o=await this.dependencies.generatePathUseCase.execute(a);if(o.success&&o.path){let l=M.fromData(o.path);await this.displayPath(l),o.warnings&&o.warnings.length>0&&console.warn("Learning path generation warnings:",o.warnings)}else this.renderErrorState(n,o.error||"Failed to generate learning path.")}catch(i){let a=i instanceof Error?i.message:"An unknown error occurred.";this.renderErrorState(n,a)}}renderLoadingState(e,r){let s=e.createDiv({cls:"learning-path-loading"}),n=s.createDiv({cls:"learning-path-spinner"});(0,m.setIcon)(n,"loader-2"),s.createEl("h3",{text:"Generating new learning path..."}),s.createEl("p",{text:`Goal: ${r}`}),s.createEl("p",{cls:"learning-path-loading-hint",text:"Analyzing with LLM... Please wait."})}renderErrorState(e,r){e.empty();let s=e.createDiv({cls:"learning-path-error"}),n=s.createDiv({cls:"learning-path-error-icon"});(0,m.setIcon)(n,"alert-circle"),s.createEl("h3",{text:"Failed to Generate Learning Path"}),s.createEl("p",{text:r}),s.createEl("button",{cls:"mod-cta",text:"Retry"}).addEventListener("click",()=>this.showCreateDialog()),s.createEl("button",{text:"Go Back"}).addEventListener("click",()=>this.renderEmptyState(e))}showPathMenu(e,r){console.log("Show path menu",r.id)}async openNote(e){let r=this.app.vault.getAbstractFileByPath(e.notePath);r&&await this.app.workspace.getLeaf().openFile(r)}async updateNodeProgress(e,r,s){if(console.log("[LearningPathView] updateNodeProgress called:",{pathId:e,nodeId:r,newLevel:s}),!this.dependencies){new m.Notice("Error: Dependencies not set"),console.error("Dependencies not set");return}if(!this.currentPath){new m.Notice("Error: No current path"),console.error("No current path");return}let n={pathId:e,nodeId:r,newLevel:s};try{console.log("[LearningPathView] Executing updateProgressUseCase...");let i=await this.dependencies.updateProgressUseCase.execute(n);if(console.log("[LearningPathView] Response:",i),i.success){let a=this.valueToMasteryLevel(s);this.currentPath=this.currentPath.updateNodeProgress(r,a),await this.refresh(),new m.Notice("Progress updated")}else new m.Notice(`Failed to update progress: ${i.error}`),console.error("Failed to update progress:",i.error)}catch(i){let a=i instanceof Error?i.message:"Unknown error";new m.Notice(`Error: ${a}`),console.error("Exception in updateNodeProgress:",i)}}valueToMasteryLevel(e){switch(e){case"in_progress":return y.inProgress();case"completed":return y.completed();default:return y.notStarted()}}async resetAllProgress(e){let r=e.resetAllProgress();this.currentPath=r,await this.refresh()}};var Fe=require("obsidian");var w=require("obsidian");var re=class extends w.PluginSettingTab{constructor(e,r){super(e,r);this.modelDropdown=null;this.plugin=r}async display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Learning Path Generator Settings"}),this.displayAISettings(e),await this.displayEmbeddingSettings(e),e.createEl("h3",{text:"Storage Settings"}),new w.Setting(e).setName("Data Storage Folder").setDesc("Folder path to store learning path data").addText(s=>s.setPlaceholder(".learning-paths").setValue(this.plugin.settings.storagePath).onChange(async n=>{this.plugin.settings.storagePath=n||".learning-paths",await this.plugin.saveSettings()})),e.createEl("h3",{text:"Frontmatter Settings"}),new w.Setting(e).setName("Mastery Level Key").setDesc("Frontmatter key to store mastery level").addText(s=>s.setPlaceholder("learning_mastery").setValue(this.plugin.settings.masteryLevelKey).onChange(async n=>{this.plugin.settings.masteryLevelKey=n||"learning_mastery",await this.plugin.saveSettings()})),new w.Setting(e).setName("Last Studied Key").setDesc("Frontmatter key to store last studied time").addText(s=>s.setPlaceholder("learning_last_studied").setValue(this.plugin.settings.lastStudiedKey).onChange(async n=>{this.plugin.settings.lastStudiedKey=n||"learning_last_studied",await this.plugin.saveSettings()})),new w.Setting(e).setName("Study Count Key").setDesc("Frontmatter key to store study count").addText(s=>s.setPlaceholder("learning_study_count").setValue(this.plugin.settings.studyCountKey).onChange(async n=>{this.plugin.settings.studyCountKey=n||"learning_study_count",await this.plugin.saveSettings()})),e.createEl("h3",{text:"General Settings"}),new w.Setting(e).setName("Excluded Folders").setDesc("Folders to exclude from learning path generation (comma-separated)").addText(s=>s.setPlaceholder("Templates, Archive").setValue(this.plugin.settings.excludeFolders.join(", ")).onChange(async n=>{this.plugin.settings.excludeFolders=n.split(",").map(i=>i.trim()).filter(i=>i.length>0),await this.plugin.saveSettings()})),new w.Setting(e).setName("Default Estimated Time").setDesc("Default estimated study time per node (minutes)").addSlider(s=>s.setLimits(5,60,5).setValue(this.plugin.settings.defaultEstimatedMinutes).setDynamicTooltip().onChange(async n=>{this.plugin.settings.defaultEstimatedMinutes=n,await this.plugin.saveSettings()})),new w.Setting(e).setName("Auto Open Sidebar View").setDesc("Automatically open learning path view when plugin loads").addToggle(s=>s.setValue(this.plugin.settings.autoOpenView).onChange(async n=>{this.plugin.settings.autoOpenView=n,await this.plugin.saveSettings()})),e.createEl("h3",{text:"Display Settings"}),new w.Setting(e).setName("Max Display Nodes").setDesc("Maximum number of nodes to display in learning path (analysis covers all notes)").addSlider(s=>s.setLimits(10,100,10).setValue(this.plugin.settings.maxDisplayNodes).setDynamicTooltip().onChange(async n=>{this.plugin.settings.maxDisplayNodes=n,await this.plugin.saveSettings()})),e.createEl("h3",{text:"About"});let r=e.createDiv({cls:"setting-item"});r.createEl("p",{text:`Learning Path Generator v${this.plugin.manifest.version}`,cls:"setting-item-description"}),r.createEl("p",{text:"Generate learning paths and curricula from your vault notes.",cls:"setting-item-description"}),r.createEl("p",{text:"Semantic search uses embedding data from the Vault Embeddings plugin.",cls:"setting-item-description"})}displayAISettings(e){e.createEl("h3",{text:"AI Settings"});let r=this.plugin.settings.ai.provider,s=f[r];new w.Setting(e).setName("Enable AI Analysis").setDesc("Use AI to analyze learning paths. If disabled, only link-based analysis is performed.").addToggle(n=>n.setValue(this.plugin.settings.ai.enabled).onChange(async i=>{this.plugin.settings.ai.enabled=i,await this.plugin.saveSettings()})),new w.Setting(e).setName("AI Provider").setDesc("Select the AI service to use").addDropdown(n=>{Object.entries(f).forEach(([i,a])=>{n.addOption(i,a.displayName)}),n.setValue(r),n.onChange(async i=>{this.plugin.settings.ai.provider=i,await this.plugin.saveSettings(),this.display()})}),new w.Setting(e).setName(`${s.displayName} API Key`).setDesc(this.getApiKeyDescription(r)).addText(n=>{var i;n.setPlaceholder("Enter API key").setValue((i=this.plugin.settings.ai.apiKeys[r])!=null?i:"").onChange(async a=>{this.plugin.settings.ai.apiKeys[r]=a,await this.plugin.saveSettings()}),n.inputEl.type="password",n.inputEl.style.width="300px"}).addButton(n=>{n.setButtonText("Test").onClick(async()=>{let i=this.plugin.settings.ai.apiKeys[r];if(!i){new w.Notice("Please enter an API key first.");return}n.setDisabled(!0),n.setButtonText("Testing...");try{await this.plugin.testApiKey(r,i)?new w.Notice(`${s.displayName} API key is valid!`):new w.Notice(`${s.displayName} API key is invalid.`)}catch(a){let o=a instanceof Error?a.message:"Unknown error";new w.Notice(`Test failed: ${o}`)}finally{n.setDisabled(!1),n.setButtonText("Test")}})}),new w.Setting(e).setName("Model").setDesc("Select the model to use").addDropdown(n=>{var i;this.modelDropdown=n,this.populateModelDropdown(n,r),n.setValue((i=this.plugin.settings.ai.models[r])!=null?i:s.defaultModel),n.onChange(async a=>{this.plugin.settings.ai.models[r]=a,await this.plugin.saveSettings()})})}populateModelDropdown(e,r){pe(r).forEach(n=>{e.addOption(n.id,n.displayName)})}getApiKeyDescription(e){switch(e){case"claude":return"Get your API key from https://console.anthropic.com";case"openai":return"Get your API key from https://platform.openai.com";case"gemini":return"Get your API key from https://aistudio.google.com";case"grok":return"Get your API key from https://console.x.ai";default:return"Enter your API key."}}async displayEmbeddingSettings(e){e.createEl("h3",{text:"Semantic Search Settings"});let r=e.createDiv({cls:"setting-item-description"});r.style.marginBottom="15px",r.style.padding="10px",r.style.backgroundColor="var(--background-secondary)",r.style.borderRadius="5px",r.innerHTML=`
      <p style="margin: 0 0 5px 0;"><strong>Vault Embeddings Integration</strong></p>
      <p style="margin: 0; font-size: 0.9em;">Note embeddings are managed by the <strong>Vault Embeddings</strong> plugin.<br>
      This plugin reads stored embeddings to perform semantic search.</p>
    `;let s=await this.plugin.getEmbeddingStats(),n=e.createDiv({cls:"embedding-stats"});n.style.padding="10px",n.style.backgroundColor="var(--background-secondary)",n.style.borderRadius="5px",n.style.marginBottom="15px",s.isAvailable?(n.createEl("p",{text:`Embeddings loaded: ${s.totalEmbeddings}`}),n.createEl("p",{text:`Model: ${s.model} (${s.provider})`,cls:"setting-item-description"})):(n.createEl("p",{text:"Vault Embeddings data not found.",cls:"mod-warning"}),n.createEl("p",{text:'Install Vault Embeddings plugin and run "Embed All Notes".',cls:"setting-item-description"})),new w.Setting(e).setName("OpenAI API Key for Query Embeddings").setDesc("OpenAI API key for embedding search queries. Leave empty to use the OpenAI key from AI settings.").addText(a=>{var o;a.setPlaceholder("sk-...").setValue((o=this.plugin.settings.embedding.openaiApiKey)!=null?o:"").onChange(async l=>{this.plugin.settings.embedding.openaiApiKey=l||void 0,await this.plugin.saveSettings()}),a.inputEl.type="password",a.inputEl.style.width="300px"}),new w.Setting(e).setName("Refresh Embeddings Cache").setDesc("Reload latest embedding data from Vault Embeddings.").addButton(a=>a.setButtonText("Refresh").onClick(async()=>{a.setDisabled(!0),a.setButtonText("Loading...");try{await this.plugin.refreshEmbeddings(),await this.display()}catch(o){new w.Notice("Refresh failed")}finally{a.setDisabled(!1),a.setButtonText("Refresh")}}));let i=e.createDiv({cls:"setting-item-description"});i.style.marginTop="10px",i.style.fontStyle="italic",i.innerHTML="Note: Create and manage note embeddings in Vault Embeddings plugin settings."}};var ye={ai:{provider:"claude",apiKeys:{},models:{},enabled:!0},embedding:{},storagePath:"_learning-paths",masteryLevelKey:"learning_mastery",lastStudiedKey:"learning_last_studied",studyCountKey:"learning_study_count",excludeFolders:["Templates","Archive",".obsidian"],defaultEstimatedMinutes:15,autoOpenView:!1,maxDisplayNodes:50};var de=class extends S.Plugin{async onload(){console.log("Loading Learning Path Generator plugin"),await this.loadSettings(),await this.migrateStoragePath(),this.noteRepository=new U(this.app),this.pathRepository=new K(this.app,{storagePath:this.settings.storagePath}),this.progressRepository=new V(this.app,{masteryLevelKey:this.settings.masteryLevelKey,lastStudiedKey:this.settings.lastStudiedKey,studyCountKey:this.settings.studyCountKey}),this.dependencyAnalyzer=new q,this.initializeAIService(),await this.initializeEmbeddingSystem(),this.generatePathUseCase=new O(this.noteRepository,this.pathRepository,this.dependencyAnalyzer,this.aiService),this.generatePathUseCase.setSemanticSearchService(this.semanticSearchAdapter),this.updateProgressUseCase=new F(this.pathRepository,this.progressRepository),this.registerView(G,t=>{let e=new te(t);return e.setDependencies({generatePathUseCase:this.generatePathUseCase,updateProgressUseCase:this.updateProgressUseCase,pathRepository:this.pathRepository,getMaxDisplayNodes:()=>this.settings.maxDisplayNodes}),e}),this.addRibbonIcon("route","Learning Path Generator",()=>{this.activateView()}),this.addCommand({id:"open-learning-path-view",name:"Open Learning Path View",callback:()=>{this.activateView()}}),this.addCommand({id:"generate-learning-path",name:"Generate Learning Path from Current Note",checkCallback:t=>this.app.workspace.getActiveFile()?(t||this.generatePathFromCurrentNote(),!0):!1}),this.addCommand({id:"refresh-embeddings",name:"Refresh Embeddings Cache (Vault Embeddings)",callback:async()=>{await this.refreshEmbeddings()}}),this.addSettingTab(new re(this.app,this)),this.settings.autoOpenView&&this.app.workspace.onLayoutReady(()=>{this.activateView()})}onunload(){console.log("Unloading Learning Path Generator plugin"),this.app.workspace.detachLeavesOfType(G),ae(),le()}async loadSettings(){let t=await this.loadData();this.settings=this.mergeSettings(ye,t)}mergeSettings(t,e){var r,s,n,i,a,o,l,c,p,g,u,v,h,b,I,E,L,N,R;return e?{ai:{provider:(s=(r=e.ai)==null?void 0:r.provider)!=null?s:e.claudeModel?"claude":t.ai.provider,apiKeys:(i=(n=e.ai)==null?void 0:n.apiKeys)!=null?i:e.claudeApiKey?{claude:e.claudeApiKey}:t.ai.apiKeys,models:(o=(a=e.ai)==null?void 0:a.models)!=null?o:e.claudeModel?{claude:e.claudeModel}:t.ai.models,enabled:(p=(l=e.ai)==null?void 0:l.enabled)!=null?p:(c=e.useLLMAnalysis)!=null?c:t.ai.enabled},embedding:{openaiApiKey:(u=(g=e.embedding)==null?void 0:g.openaiApiKey)!=null?u:t.embedding.openaiApiKey},storagePath:(v=e.storagePath)!=null?v:t.storagePath,masteryLevelKey:(h=e.masteryLevelKey)!=null?h:t.masteryLevelKey,lastStudiedKey:(b=e.lastStudiedKey)!=null?b:t.lastStudiedKey,studyCountKey:(I=e.studyCountKey)!=null?I:t.studyCountKey,excludeFolders:(E=e.excludeFolders)!=null?E:t.excludeFolders,defaultEstimatedMinutes:(L=e.defaultEstimatedMinutes)!=null?L:t.defaultEstimatedMinutes,autoOpenView:(N=e.autoOpenView)!=null?N:t.autoOpenView,maxDisplayNodes:(R=e.maxDisplayNodes)!=null?R:t.maxDisplayNodes}:{...t}}async getEmbeddingStats(){var r,s;if(!((s=(r=this.embeddingService)==null?void 0:r.isAvailable())!=null?s:!1))return{totalEmbeddings:0,provider:"N/A",model:"N/A",isAvailable:!1};let e=await this.vectorStore.getStats();return{totalEmbeddings:e.totalEmbeddings,provider:e.provider,model:e.model,isAvailable:!0}}async saveSettings(){await this.saveData(this.settings),await this.reinitializeServices()}async migrateStoragePath(){let t=".learning-paths",e="_learning-paths";if(this.settings.storagePath!==t)return;let r=this.app.vault.getAbstractFileByPath(t);if(!r||!(r instanceof S.TFolder)){this.settings.storagePath=e,await this.saveData(this.settings),console.log("[Migration] Updated storagePath to",e);return}if(!this.app.vault.getAbstractFileByPath(e))try{await this.app.vault.createFolder(e),console.log("[Migration] Created new folder:",e)}catch(i){if(!(i instanceof Error)||!i.message.includes("Folder already exists")){console.error("[Migration] Failed to create folder:",i);return}}let n=r.children.filter(i=>i instanceof S.TFile);for(let i of n)if(i instanceof S.TFile){let a=`${e}/${i.name}`;try{await this.app.vault.rename(i,a),console.log("[Migration] Moved file:",i.path,"->",a)}catch(o){console.error("[Migration] Failed to move file:",i.path,o)}}try{let i=this.app.vault.getAbstractFileByPath(t);i instanceof S.TFolder&&i.children.length===0&&(await this.app.vault.delete(i),console.log("[Migration] Deleted old folder:",t))}catch(i){console.error("[Migration] Failed to delete old folder:",i)}this.settings.storagePath=e,await this.saveData(this.settings),console.log("[Migration] Migration complete. storagePath updated to",e),new S.Notice("Learning path storage folder has been migrated.")}initializeAIService(){this.aiService=ie({provider:this.settings.ai.provider,apiKeys:this.settings.ai.apiKeys,models:this.settings.ai.models,enabled:this.settings.ai.enabled}),this.aiService.registerProvider("claude",new j),this.aiService.registerProvider("openai",new H),this.aiService.registerProvider("gemini",new W),this.aiService.registerProvider("grok",new J)}async initializeEmbeddingSystem(){let t=this.settings.embedding.openaiApiKey||this.settings.ai.apiKeys.openai;if(this.embeddingProvider=new Q(t||""),this.vectorStore=new Y(this.app,{storagePath:"09_Embedded",embeddingsFolder:"embeddings"}),await this.vectorStore.initialize(),this.embeddingService=he(this.embeddingProvider,this.vectorStore),this.semanticSearchAdapter=new Z(this.embeddingService),!t)console.warn("[LearningPathGenerator] OpenAI API key not configured. Semantic search queries will fail."),new S.Notice("Learning Path Generator: API key not configured. Set it in Settings for AI-powered paths.");else{let e=await this.vectorStore.getStats();console.log(`[LearningPathGenerator] Embedding system initialized: ${e.totalEmbeddings} embeddings from Vault Embeddings`)}}async refreshEmbeddings(){try{await this.vectorStore.refresh();let t=await this.vectorStore.getStats();new S.Notice(`Embeddings refreshed: ${t.totalEmbeddings} items`)}catch(t){console.error("[LearningPathGenerator] Failed to refresh embeddings:",t),new S.Notice("Failed to refresh embeddings")}}async reinitializeServices(){this.pathRepository=new K(this.app,{storagePath:this.settings.storagePath}),this.progressRepository=new V(this.app,{masteryLevelKey:this.settings.masteryLevelKey,lastStudiedKey:this.settings.lastStudiedKey,studyCountKey:this.settings.studyCountKey}),this.aiService.updateSettings({provider:this.settings.ai.provider,apiKeys:this.settings.ai.apiKeys,models:this.settings.ai.models,enabled:this.settings.ai.enabled}),le(),await this.initializeEmbeddingSystem(),this.generatePathUseCase=new O(this.noteRepository,this.pathRepository,this.dependencyAnalyzer,this.aiService),this.generatePathUseCase.setSemanticSearchService(this.semanticSearchAdapter),this.updateProgressUseCase=new F(this.pathRepository,this.progressRepository)}async testApiKey(t,e){return this.aiService.testApiKey(t,e)}async activateView(){let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(G);r.length>0?e=r[0]:(e=t.getRightLeaf(!1),e&&await e.setViewState({type:G,active:!0})),e&&t.revealLeaf(e)}async generatePathFromCurrentNote(){var i,a;let t=this.app.workspace.getActiveFile();if(!t){new S.Notice("No active note.");return}let e=D(t.path),r=t.basename;await this.activateView();let s=this.app.workspace.getLeavesOfType(G);if(s.length===0){new S.Notice("Cannot open learning path view.");return}let n=s[0].view;await n.clearCurrentPath();try{let o=await this.pathRepository.findByGoalNote(e);if(o){await n.displayPath(o),new S.Notice(`Loaded existing learning path: ${r}`);return}new S.Notice(`Generating learning path for '${r}'...`),await n.showLoadingState(r);let l=await this.generatePathUseCase.execute({name:`Learning path to ${r}`,goalNoteId:e,excludeFolders:this.settings.excludeFolders});if(l.success&&l.path){let c=(a=(i=l.nodes)==null?void 0:i.length)!=null?a:0;new S.Notice(`Learning path generated! ${c} nodes`),l.warnings&&l.warnings.length>0&&new S.Notice(`Warning: ${l.warnings.join(", ")}`,5e3);let p=await this.pathRepository.findById(l.path.id);p&&await n.displayPath(p)}else await n.showErrorState(l.error||"Failed to generate learning path."),new S.Notice(`Failed to generate learning path: ${l.error}`,5e3),console.error("Failed to generate path:",l.error)}catch(o){let l=o instanceof Error?o.message:"Unknown error";await n.showErrorState(l),new S.Notice(`Error: ${l}`,5e3),console.error("Error generating path:",o)}}};
